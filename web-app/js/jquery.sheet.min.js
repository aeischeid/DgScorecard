/*
jQuery.sheet() The Web Based Spreadsheet
$Id: jquery.sheet.min.js 467 2012-03-16 18:25:04Z robertleeplummerjr $
http://code.google.com/p/jquerysheet/
		
Copyright (c) 2012 Robert Plummer, RobertLeePlummerJr@gmail.com
Licensed under MIT
Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/
jQuery.fn.extend({sheet:function(a){jQuery(this).each(function(){var b=jQuery(this);var d=jQuery.extend({urlGet:"sheets/enduser.documentation.html",urlSave:"save.html",editable:true,editableTabs:true,barMenus:true,freezableCells:false,allowToggleState:true,urlMenu:"menu.html",menu:"",newColumnWidth:120,title:null,inlineMenu:null,buildSheet:false,calcOff:false,log:false,lockFormulas:false,parent:b,colMargin:18,fnSave:function(){b.getSheet().saveSheet()},fnOpen:function(){var f=prompt("Paste your table html here");if(f){b.getSheet().openSheet(f)}},fnClose:function(){},boxModelCorrection:2,calculations:{},cellSelectModel:"excel",autoAddCells:true,resizable:true,autoFiller:false,minSize:{rows:15,cols:5},forceColWidthsOnStartup:true,alertFormulaErrors:false},a);var c=b.getSheet();if(c){b.html(c.obj.sheetAll());c.obj.tabContainer().remove();delete c}if(jQuery.sheet.instance){b.sheetInstance=jQuery.sheet.createInstance(d,jQuery.sheet.instance.length,b);jQuery.sheet.instance.push(b.sheetInstance)}else{b.sheetInstance=jQuery.sheet.createInstance(d,0,b);jQuery.sheet.instance=[b.sheetInstance]}b.attr("sheetInstance",jQuery.sheet.instance.length-1)});return this},disableSelectionSpecial:function(){this.each(function(){this.onselectstart=function(){return false};this.unselectable="on";jQuery(this).css("-moz-user-select","none")});return this},getSheet:function(){var a=parseInt(jQuery(this).attr("sheetInstance"));if(!isNaN(a)){return jQuery.sheet.instance[a]}return false},getCellValue:function(f,a,b){var c=$(this).getSheet();b=(b?b:0);try{return c.spreadsheets[b][f][a].value}catch(d){return""}}});jQuery.sheet={createInstance:function(d,c,b){var f={version:"2.0.x",i:0,I:c,sheetCount:0,spreadsheets:[],obj:{autoFiller:function(){return jQuery("#"+f.id.autoFiller+f.i)},barCorner:function(){return jQuery("#"+f.id.barCorner+f.i)},barCornerAll:function(){return d.parent.find("div."+f.cl.barCorner)},barCornerParent:function(){return jQuery("#"+f.id.barCornerParent+f.i)},barCornerParentAll:function(){return d.parent.find("td."+f.cl.barCornerParent)},barHelper:function(){return jQuery("div."+f.cl.barHelper)},barLeft:function(){return jQuery("#"+f.id.barLeft+f.i)},barLeftAll:function(){return d.parent.find("div."+f.cl.barLeft)},barLeftParent:function(){return jQuery("#"+f.id.barLeftParent+f.i)},barLeftParentAll:function(){return d.parent.find("div."+f.cl.barLeftParent)},barLeftHandle:function(){return jQuery("#"+f.id.barLeftHandle)},barLeftMenu:function(){return jQuery("#"+f.id.barLeftMenu)},barTop:function(){return jQuery("#"+f.id.barTop+f.i)},barTopAll:function(){return d.parent.find("div."+f.cl.barTop)},barTopParent:function(){return jQuery("#"+f.id.barTopParent+f.i)},barTopParentAll:function(){return d.parent.find("div."+f.cl.barTopParent)},barTopHandle:function(){return jQuery("#"+f.id.barTopHandle)},barTopMenuParent:function(){return jQuery("#"+f.id.barTopMenuParent)},barTopMenu:function(){return jQuery("#"+f.id.barTopMenu)},cellActive:function(){return jQuery(f.cellLast.td)},cellMenu:function(){return jQuery("#"+f.id.cellMenu)},cellHighlighted:function(){return jQuery(f.highlightedLast.td)},chart:function(){return jQuery("div."+f.cl.chart)},controls:function(){return jQuery("#"+f.id.controls)},formula:function(){return jQuery("#"+f.id.formula)},fullScreen:function(){return jQuery("div."+f.cl.fullScreen)},inlineMenu:function(){return jQuery("#"+f.id.inlineMenu)},inPlaceEdit:function(){return jQuery("#"+f.id.inPlaceEdit)},label:function(){return jQuery("#"+f.id.label)},menu:function(){return jQuery("#"+f.id.menu)},pane:function(){return jQuery("#"+f.id.pane+f.i)},paneAll:function(){return d.parent.find("div."+f.cl.pane)},parent:function(){return d.parent},sheet:function(){return jQuery("#"+f.id.sheet+f.i)},sheetAll:function(){return d.parent.find("table."+f.cl.sheet)},tab:function(){return jQuery("#"+f.id.tab+f.i)},tabAll:function(){return this.tabContainer().find("a."+f.cl.tab)},tabContainer:function(){return jQuery("#"+f.id.tabContainer)},tableBody:function(){return document.getElementById(f.id.sheet+f.i)},tableControl:function(){return jQuery("#"+f.id.tableControl+f.i)},tableControlAll:function(){return d.parent.find("table."+f.cl.tableControl)},title:function(){return jQuery("#"+f.id.title)},ui:function(){return jQuery("#"+f.id.ui)},uiActive:function(){return d.parent.find("div."+f.cl.uiActive)}},id:{autoFiller:"jSheetAutoFiller_"+c+"_",barCorner:"jSheetBarCorner_"+c+"_",barCornerParent:"jSheetBarCornerParent_"+c+"_",barLeft:"jSheetBarLeft_"+c+"_",barLeftParent:"jSheetBarLeftParent_"+c+"_",barLeftHandle:"jSheetBarLeftHandle_"+c,barLeftMenu:"jSheetBarLeftMenu_"+c,barTop:"jSheetBarTop_"+c+"_",barTopParent:"jSheetBarTopParent_"+c+"_",barTopHandle:"jSheetBarTopHandle",barTopMenu:"jSheetBarTopMenu_"+c,barTopMenuParent:"jSheetBarTopMenuParent_"+c,cellMenu:"jSheetCellMenu_"+c,controls:"jSheetControls_"+c,formula:"jSheetControls_formula_"+c,inlineMenu:"jSheetInlineMenu_"+c,inPlaceEdit:"jSheetInPlaceEdit_"+c,label:"jSheetControls_loc_"+c,menu:"jSheetMenu_"+c,pane:"jSheetEditPane_"+c+"_",sheet:"jSheet_"+c+"_",tableControl:"tableControl_"+c+"_",tab:"jSheetTab_"+c+"_",tabContainer:"jSheetTabContainer_"+c,title:"jSheetTitle_"+c,ui:"jSheetUI_"+c},cl:{autoFiller:"jSheetAutoFiller",autoFillerHandle:"jSheetAutoFillerHandle",autoFillerConver:"jSheetAutoFillerCover",barCorner:"jSheetBarCorner",barCornerParent:"jSheetBarCornerParent",barHelper:"jSheetBarHelper",barLeftTd:"jSheetBarLeftTd",barLeft:"jSheetBarLeft",barLeftHandle:"jSheetBarLeftHandle",barLeftParent:"jSheetBarLeftParent",barTop:"jSheetBarTop",barTopHandle:"jSheetBarTopHandle",barTopParent:"jSheetBarTopParent",barTopTd:"jSheetBarTopTd",cellActive:"jSheetCellActive",cellHighlighted:"jSheetCellHighighted",chart:"jSheetChart",controls:"jSheetControls",error:"jSheetError",formula:"jSheetControls_formula",formulaParent:"jSheetControls_formulaParent",inlineMenu:"jSheetInlineMenu",fullScreen:"jSheetFullScreen",inPlaceEdit:"jSheetInPlaceEdit",menu:"jSheetMenu",parent:"jSheetParent",sheet:"jSheet",sheetPaneTd:"sheetPane",label:"jSheetControls_loc",pane:"jSheetEditPane",tab:"jSheetTab",tabContainer:"jSheetTabContainer",tabContainerFullScreen:"jSheetFullScreenTabContainer",tableControl:"tableControl",title:"jSheetTitle",toggle:"cellStyleToggle",ui:"jSheetUI",uiAutoFiller:"ui-state-active",uiActive:"ui-state-active",uiBar:"ui-widget-header",uiBarHighlight:"ui-state-highlight",uiBarLeftHandle:"ui-state-default",uiBarLeftMenu:"ui-state-default ui-corner-top",uiBarTopHandle:"ui-state-default",uiBarTopMenu:"ui-state-default ui-corner-top",uiCellActive:"ui-state-active",uiCellHighlighted:"ui-state-highlight",uiControl:"ui-widget-header ui-corner-top",uiControlTextBox:"ui-widget-content",uiError:"ui-state-error",uiFullScreen:"ui-widget-content ui-corner-all",uiInPlaceEdit:"ui-state-active",uiMenu:"ui-state-default",uiMenuUl:"ui-widget-header",uiMenuLi:"ui-widget-header",uiMenuHighlighted:"ui-state-highlight",uiPane:"ui-widget-content",uiParent:"ui-widget-content ui-corner-all",uiSheet:"ui-widget-content",uiTab:"ui-widget-header",uiTabActive:"ui-state-highlight"},msg:{addRowMulti:"How many rows would you like to add?",addColumnMulti:"How many columns would you like to add?",newSheet:"What size would you like to make your spreadsheet? Example: '5x10' creates a sheet that is 5 columns by 10 rows.",openSheet:"Are you sure you want to open a different sheet?  All unsaved changes will be lost.",cellFind:"No results found.",toggleHideRow:"No row selected.",toggleHideColumn:"Now column selected.",merge:"Merging is not allowed on the first row.",evalError:"Error, functions as formulas not supported.",menuInsertColumnAfter:"Insert column after",menuInsertColumnBefore:"Insert column before",menuAddColumnEnd:"Add column to end",menuDeleteColumn:"Delete this column",menuInsertRowAfter:"Insert row after",menuInsertRowBefore:"Insert row before",menuAddRowEnd:"Add row to end",menuDeleteRow:"Delete this row",menuAddSheet:"Add spreadsheet",menuDeleteSheet:"Delete spreadsheet"},kill:function(){f.obj.tabContainer().remove();f.obj.fullScreen().remove();f.obj.inPlaceEdit().remove();b.removeClass(f.cl.uiParent).html("").removeAttr("sheetInstance");cE=d=jQuery.sheet.instance[c]=f=null;delete cE;delete d;delete jQuery.sheet.instance[c];delete f},trigger:function(h,i){i=(i?i:[]);b.trigger(h,[f].concat(i))},spreadsheetsToArray:function(h){if(h||f.spreadsheets.length==0){f.cycleCellsAll(function(j,k,i){var l=jQuery(this);f.createCell(j,k,i,l.text(),l.attr("formula"))})}return f.spreadsheets},spreadsheetToArray:function(j,h){h=(h?h:f.i);if(j||!f.spreadsheets[h]){f.cycleCells(function(k,l,i){var m=jQuery(this);f.createCell(k,l,i,m.text(),m.attr("formula"))})}},createCell:function(j,m,i,l,n,k,h){if(!f.spreadsheets[j]){f.spreadsheets[j]=[]}if(!f.spreadsheets[j][m]){f.spreadsheets[j][m]=[]}f.spreadsheets[j][m][i]={formula:n,value:l,calcCount:(k?k:0),calcLast:(h?h:-1)};return f.spreadsheets[j][m][i]},nav:false,setNav:function(h){jQuery(jQuery.sheet.instance).each(function(){this.nav=false});f.nav=h},controlFactory:{addRowMulti:function(j,h,i){if(!j){j=prompt(f.msg.addRowMulti)}if(j){if(!isNaN(j)){f.controlFactory.addCells(null,h,null,parseInt(j),"row",i)}}},addColumnMulti:function(j,h,i){if(!j){j=prompt(f.msg.addColumnMulti)}if(j){if(!isNaN(j)){f.controlFactory.addCells(null,h,null,parseInt(j),"col",i)}}},addCells:function(A,C,x,r,m,n){if(d.autoFiller){f.obj.autoFiller().hide()}f.setDirty(true);f.obj.barHelper().remove();var p=f.obj.sheet();var v=p.width();r=(r?r:1);m=(m?m:"col");var j=(m=="row"?f.cellLast.row:f.cellLast.col);if(!A){if(j==-1){A=":last"}else{A=":eq("+j+")"}}else{if(!isNaN(A)){A=":eq("+(A)+")"}}var w;switch(m){case"row":w={bar:f.obj.barLeft().children("div"+A),barParent:f.obj.barLeft(),cells:function(){return p.find("tr"+A)},col:function(){return""},newBar:'<div class="'+f.cl.uiBar+'" style="height: '+(d.colMargin-d.boxModelCorrection)+'px;" />',size:function(){return f.getTdLocation(w.cells().find("td:last"))},loc:function(){return f.getTdLocation(w.cells().find("td:first"))},newCells:function(){var o=w.size().col;var E="";for(var D=0;D<=o;D++){E+="<td />"}return'<tr style="height: '+d.colMargin+'px;">'+E+"</tr>"},newCol:"",reLabel:function(){w.barParent.children().each(function(o){jQuery(this).text(o+1)})},dimensions:function(D,i,o){D.height(i.height(d.colMargin).outerHeight()-d.boxModelCorrection)},offset:{row:r,col:0}};break;case"col":w={bar:f.obj.barTop().children("div"+A),barParent:f.obj.barTop(),cells:function(){var I=p.find("tr:first").children(A);var H=p.find("td:last");var G=f.getTdLocation(I);var F=f.getTdLocation(H);var D=jQuery(f.getTd(f.i,G.row,G.col));var o;for(var E=1;E<=F.row;E++){D.push(f.getTd(f.i,E,G.col))}return D},col:function(){return p.find("col"+A)},newBar:'<div class="'+f.cl.uiBar+'"/>',newCol:"<col />",loc:function(i){i=(i?i:w.cells());return f.getTdLocation(i.first())},newCells:function(){return"<td />"},reLabel:function(){w.barParent.children().each(function(o){jQuery(this).text(jSE.columnLabelString(o))})},dimensions:function(E,i,D){var o=d.newColumnWidth;D.width(o).css("width",o+"px").attr("width",o+"px");E.width(o-d.boxModelCorrection);p.width(v+(o*r))},offset:{row:0,col:r}};break}f.cellUndoable.add(jQuery(p).add(w.barParent));var l=w.cells();var s=w.loc(l);var q=w.col();var u=w.newBar;var t=w.newCells();var k=w.newCol;var z="";var h="";var B="";for(var y=0;y<r;y++){z+=k;h+=u;B+=t}z=jQuery(z);h=jQuery(h);B=jQuery(B);if(C){l.before(B);w.bar.before(h);jQuery(q).before(z)}else{l.after(B);w.bar.after(h);jQuery(q).after(z)}f.setTdIds(p,f.i);w.dimensions(h,B,z);w.reLabel();f.obj.pane().scroll();if(!n&&A!=":last"){f.offsetFormulas(s,w.offset,C)}f.sheetSyncSize();f.cellUndoable.add(jQuery(p).add(w.barParent))},addRow:function(j,i,h){f.controlFactory.addCells(j,i,h,1,"row");f.trigger("addRow",[j,i,h,1])},addColumn:function(j,i,h){f.controlFactory.addCells(j,i,h,1,"col");f.trigger("addColumn",[j,i,h,1])},barLeft:function(j,k){f.obj.barLeft().remove();var h=jQuery('<div border="1px" id="'+f.id.barLeft+f.i+'" class="'+f.cl.barLeft+'" />');var i;if(j){i=function(l,m,n){n.height(parseInt(m.outerHeight())-d.boxModelCorrection)}}else{i=function(l,m,n){n.height(parseInt(m.css("height").replace("px",""))-d.boxModelCorrection)}}k.find("tr").each(function(l){var m=jQuery("<div>"+(l+1)+"</div>");h.append(m);i(l,jQuery(this),m)});f.evt.barMouseDown.height(f.obj.barLeftParent().append(h))},barTop:function(h,k){f.obj.barTop().remove();var j=jQuery('<div id="'+f.id.barTop+f.i+'" class="'+f.cl.barTop+'" />');j.height(d.colMargin);var i;var l;if(h){i=k.find("tr:first").children();l=function(m){return f.attrH.width(m)}}else{i=k.find("col");l=function(m){return parseInt(jQuery(m).css("width").replace("px",""))-d.boxModelCorrection}}i.each(function(o){var n=jSE.columnLabelString(o);var m=l(this);var p=jQuery("<div>"+n+"</div>").width(m).height(d.colMargin);j.append(p)});f.evt.barMouseDown.width(f.obj.barTopParent().append(j))},barTopHandle:function(j,h){if(f.busy){return false}if(h!=0){return false}f.obj.barHelper().remove();var l=f.obj.barTop().children().eq(h);var m=l.position();var k=jQuery('<div id="'+f.id.barTopHandle+'" class="'+f.cl.uiBarTopHandle+" "+f.cl.barHelper+" "+f.cl.barTopHandle+'" />').height(d.colMargin-2).css("left",m.left+"px").appendTo(j);f.draggable(k,{axis:"x",start:function(){f.busy=true},stop:function(){f.busy=false}})},barLeftHandle:function(j,h){if(f.busy){return false}if(h!=0){return false}f.obj.barHelper().remove();var k=f.obj.barLeft().children().eq(h);var m=k.position();var l=jQuery('<div id="'+f.id.barLeftHandle+'" class="'+f.cl.uiBarLeftHandle+" "+f.cl.barHelper+" "+f.cl.barLeftHandle+'" />').width(d.colMargin-6).height(d.colMargin/3).css("top",m.top+"px").appendTo(j);f.draggable(l,{axis:"y",start:function(){f.busy=true},stop:function(){f.busy=false}})},makeMenu:function(i,h){var k;function j(m,l){switch(m){case"line":jQuery("<hr />").appendTo(k);break;default:jQuery("<div>"+m+"</div>").click(function(){l();return false}).appendTo(k)}}switch(i){case"top":k=jQuery('<div id="'+f.id.barTopMenu+'" class="'+f.cl.uiMenu+" "+f.cl.barHelper+'" />');break;case"left":k=jQuery('<div id="'+f.id.barLeftMenu+'" class="'+f.cl.uiMenu+" "+f.cl.barHelper+'" />');break;case"cell":k=jQuery('<div id="'+f.id.cellMenu+'" class="'+f.cl.uiMenu+" "+f.cl.barHelper+'" />');break}k.width(d.newColumnWidth).mouseleave(function(){k.hide()}).appendTo("body").hide();jQuery(h).each(function(){j(this.msg,this.fn)});return k},barTopMenu:function(l,j,k){if(f.busy){return false}var m=f.obj.barTopMenu().hide();if(j){f.obj.barTopHandle().remove()}var m;if(!m.length){m=f.controlFactory.makeMenu("top",[{msg:f.msg.menuInsertColumnAfter,fn:function(){f.controlFactory.addColumn();return false}},{msg:f.msg.menuInsertColumnBefore,fn:function(){f.controlFactory.addColumn(null,true);return false}},{msg:f.msg.menuAddColumnEnd,fn:function(){f.controlFactory.addColumn(":last");return false}},{msg:f.msg.menuDeleteColumn,fn:function(){f.deleteColumn();return false}}])}if(!k){m.css("left",(l.pageX-5)+"px").css("top",(l.pageY-5)+"px").show();return m}var h=f.obj.barTopMenuParent().hide();if(!h.length){h=jQuery('<div id="'+f.id.barTopMenuParent+'" class="'+f.cl.uiBarTopMenu+" "+f.cl.barHelper+'"><span class="ui-icon ui-icon-triangle-1-s" /></span></div>').click(function(i){h.parent().mousedown().mouseup();var n=h.offset();m.css("left",(n.left-(d.newColumnWidth-d.colMargin))+"px").css("top",(n.top+(d.colMargin*0.8))+"px").show()}).blur(function(){if(m){m.hide()}}).height(d.colMargin)}h.appendTo(k).show()},barLeftMenu:function(j,h){if(f.busy){return false}f.obj.barLeftMenu().hide();if(h){f.obj.barLeftHandle().remove()}var k;k=f.obj.barLeftMenu();if(!k.length){k=f.controlFactory.makeMenu("left",[{msg:f.msg.menuInsertRowAfter,fn:function(){f.controlFactory.addRow();return false}},{msg:f.msg.menuInsertRowBefore,fn:function(){f.controlFactory.addRow(null,true);return false}},{msg:f.msg.menuAddRowEnd,fn:function(){f.controlFactory.addRow(":last");return false}},{msg:f.msg.menuDeleteRow,fn:function(){f.deleteRow();return false}}])}k.css("left",(j.pageX-5)+"px").css("top",(j.pageY-5)+"px").show()},cellMenu:function(h){if(f.busy){return false}f.obj.cellMenu().hide();var i=f.obj.cellMenu();if(!i.length){i=f.controlFactory.makeMenu("cell",[{msg:f.msg.menuInsertColumnAfter,fn:function(){f.controlFactory.addColumn();return false}},{msg:f.msg.menuInsertColumnBefore,fn:function(){f.controlFactory.addColumn(null,true);return false}},{msg:f.msg.menuAddColumnEnd,fn:function(){f.controlFactory.addColumn(":last");return false}},{msg:f.msg.menuDeleteColumn,fn:function(){f.deleteColumn();return false}},{msg:"line"},{msg:f.msg.menuInsertRowAfter,fn:function(){f.controlFactory.addRow();return false}},{msg:f.msg.menuInsertRowBefore,fn:function(){f.controlFactory.addRow(null,true);return false}},{msg:f.msg.menuAddRowEnd,fn:function(){f.controlFactory.addRow(":last");return false}},{msg:f.msg.menuDeleteRow,fn:function(){f.deleteRow();return false}},{msg:"line"},{msg:f.msg.menuAddSheet,fn:function(){f.addSheet("5x10")}},{msg:f.msg.menuDeleteSheet,fn:function(){f.deleteSheet()}}])}i.css("left",(h.pageX-5)+"px").css("top",(h.pageY-5)+"px").show()},header:function(){f.obj.controls().remove();f.obj.tabContainer().remove();var k=jQuery('<div id="'+f.id.controls+'" class="'+f.cl.controls+'"></div>');var h=jQuery('<table cellpadding="0" cellspacing="0" border="0"><tr /></table>').prependTo(k);var i=jQuery("<tr />");if(d.title){var n;if(jQuery.isFunction(d.title)){n=f.title(f)}else{n=d.title}i.append(jQuery('<td id="'+f.id.title+'" class="'+f.cl.title+'" />').html(n))}if(d.inlineMenu&&f.isSheetEditable()){var o;if(jQuery.isFunction(d.inlineMenu)){o=d.inlineMenu(f)}else{o=d.inlineMenu}i.append(jQuery('<td id="'+f.id.inlineMenu+'" class="'+f.cl.inlineMenu+'" />').html(o))}if(f.isSheetEditable()){function l(r){var s=jQuery('<td id="'+f.id.menu+'" class="'+f.cl.menu+'" />').html(r.replace(/sheetInstance/g,"jQuery.sheet.instance["+c+"]").replace(/menuInstance/g,c));s.prependTo(i).find("ul").hide().addClass(f.cl.uiMenuUl).first().show();s.find("li").addClass(f.cl.uiMenuLi).hover(function(){jQuery(this).find("ul:first").hide().show()},function(){jQuery(this).find("ul:first").hide()});return s}if(d.menu){l(d.menu)}else{jQuery("<div />").load(d.urlMenu,function(){l(jQuery(this).html());f.sheetSyncSize()})}var m=jQuery('<table cellpadding="0" cellspacing="0" border="0"><tr><td id="'+f.id.label+'" class="'+f.cl.label+'"></td><td class="'+f.cl.formulaParent+'"><textarea id="'+f.id.formula+'" class="'+f.cl.formula+'"></textarea></td></tr></table>').appendTo(k).find("textarea").keydown(f.evt.keyDownHandler.formulaKeydown).keyup(function(){f.obj.inPlaceEdit().val(f.obj.formula().val())}).change(function(){f.obj.inPlaceEdit().val(f.obj.formula().val())}).bind("paste",f.evt.pasteOverCells).focus(function(){f.setNav(false)}).focusout(function(){f.setNav(true)}).blur(function(){f.setNav(true)});jQuery(jQuery.sheet.instance).each(function(){this.nav=false});f.setNav(true);jQuery(document).unbind("keydown").keydown(f.evt.keyDownHandler.documentKeydown).click(function(s){var r=jQuery(s.target);if(r.is(":input")&&!r.hasClass(f.cl.inPlaceEdit)&&!r.hasClass(f.cl.formula)){document.jSKeydownSkip=true}else{document.jSKeydownSkip=false}})}i.appendTo(h);var p=jQuery('<div id="'+f.id.tabContainer+'" class="'+f.cl.tabContainer+'" />').mousedown(function(r){f.trigger("switchSpreadsheet",[jQuery(r.target).attr("i")*1]);return false}).dblclick(function(r){f.trigger("renameSpreadsheet",[jQuery(r.target).attr("i")*1]);return});if(f.isSheetEditable()){var q=jQuery('<span class="'+f.cl.uiTab+' ui-corner-bottom" title="Add a spreadsheet" i="-1">+</span>').appendTo(p);if(jQuery.fn.sortable){var j;p.sortable({placeholder:"ui-state-highlight",axis:"x",forceHelperSize:true,forcePlaceholderSize:true,opacity:0.6,cancel:'span[i="-1"]',start:function(s,r){j=r.item.index();f.trigger("tabSortstart",[s,r])},update:function(s,r){f.trigger("tabSortupdate",[s,r,j])}})}}else{jQuery("<span />").appendTo(p)}d.parent.html("").append(k).append('<div id="'+f.id.ui+'" class="'+f.cl.ui+'">').after(p)},sheetUI:function(m,j,k,l){if(!j){f.sheetCount=0;f.i=0}else{f.sheetCount=parseInt(j);f.i=f.sheetCount;j=f.i}m=f.tuneTableForSheetUse(m);f.readOnly[j]=m.hasClass("readonly");var h=f.controlFactory.table().appendTo(f.obj.ui());var p=f.obj.pane().html(m);if(d.autoFiller&&f.isSheetEditable()){p.append(f.controlFactory.autoFiller())}f.sheetDecorate(m);f.controlFactory.barTop(l,m);f.controlFactory.barLeft(l,m);f.sheetTab(true);if(f.isSheetEditable()){var n=f.obj.formula();p.mousedown(function(i){if(f.isTd(i.target)){f.evt.cellOnMouseDown(i);return false}}).bind("contextmenu",function(i){f.controlFactory.cellMenu(i);return false}).disableSelectionSpecial().dblclick(f.evt.cellOnDblClick)}f.themeRoller.start(j);f.setTdIds(m,f.i);f.checkMinSize(m);f.evt.scrollBars(p);f.addTab();if(k){k(h,p)}return h},table:function(){return jQuery('<table cellpadding="0" cellspacing="0" border="0" id="'+f.id.tableControl+f.i+'" class="'+f.cl.tableControl+'"><tbody><tr><td id="'+f.id.barCornerParent+f.i+'" class="'+f.cl.barCornerParent+'"><div style="height: '+d.colMargin+"; width: "+d.colMargin+';" id="'+f.id.barCorner+f.i+'" class="'+f.cl.barCorner+'"'+(f.isSheetEditable()?' onClick="jQuery.sheet.instance['+c+"].cellSetActiveBar('all');\"":"")+' title="Select All">&nbsp;</div></td><td class="'+f.cl.barTopTd+'"><div id="'+f.id.barTopParent+f.i+'" class="'+f.cl.barTopParent+'"></div></td></tr><tr><td class="'+f.cl.barLeftTd+'"><div style="width: '+d.colMargin+';" id="'+f.id.barLeftParent+f.i+'" class="'+f.cl.barLeftParent+'"></div></td><td class="'+f.cl.sheetPaneTd+'"><div id="'+f.id.pane+f.i+'" class="'+f.cl.pane+'"></div></td></tr></tbody></table>')},chartCache:[],safeImg:function(i,h){return jQuery("<img />").hide().load(function(){jQuery(this).fadeIn(function(){jQuery(this).addClass("safeImg");f.attrH.setHeight(parseInt(h),"cell",false)})}).attr("src",i)},inPlaceEdit:function(o){f.obj.inPlaceEdit().remove();var n=f.obj.formula();var m=o.offset();var l=o.attr("style");var j=o.width();var k=o.height();var i=jQuery('<textarea id="'+f.id.inPlaceEdit+'" class="'+f.cl.inPlaceEdit+" "+f.cl.uiInPlaceEdit+'" />').css("left",m.left).css("top",m.top).width(j).height(k).keydown(f.evt.inPlaceEditOnKeyDown).keyup(function(){n.val(i.val())}).change(function(){n.val(i.val())}).focus(function(){f.setNav(false)}).focusout(function(){f.setNav(true)}).blur(function(){f.setNav(true)}).bind("paste",f.evt.pasteOverCells).appendTo("body").val(n.val()).focus().select();if(jQuery.fn.elastic){i.elastic()}},autoFiller:function(){return jQuery('<div id="'+(f.id.autoFiller+f.i)+'" class="'+f.cl.autoFiller+" "+f.cl.uiAutoFiller+'"><div class="'+f.cl.autoFillerHandle+'" /><div class="'+f.cl.autoFillerCover+'" /></div>').mousedown(function(h){var j=f.cellLast.td;if(j){var i=f.getTdLocation(j);f.cellSetActive(j,i,true,f.autoFillerNotGroup,function(){var l=f.obj.cellHighlighted();var k=f.getTdLocation(l.first());f.fillUpOrDown(k.row<i.row||k.col<i.col);f.autoFillerGoToTd(l.last());f.autoFillerNotGroup=false})}})}},autoFillerNotGroup:true,sizeSync:{},updateCellsAfterPasteToFormula:function(u){var t=0;var r=f.obj.formula();u=(u?u:r.val());var q={row:f.cellLast.row,col:f.cellLast.col};var k=r.val();var m=k;if(q.row==-1&&q.col==-1){return false}var o=jQuery("<div />");var s=jQuery("<div />");var w=k.split(/\n/g);for(var p=0;p<w.length;p++){var h=w[p].split(/\t/g);for(var n=0;n<h.length;n++){t++;var l=jQuery(f.getTd(f.i,p+q.row,n+q.col));if(l.length){var v=f.spreadsheets[f.i][p+q.row][n+q.col];o.append(l.clone());if((h[n]+"").charAt(0)=="="){v.formula=h[n];l.attr("formula",h[n])}else{v.formula=null;v.value=h[n];l.html(h[n]).removeAttr("formula")}s.append(l.clone());if(p==0&&n==0){m=h[n]}}}}if(k!=m){r.val(m)}f.cellUndoable.add(o.children());f.fillUpOrDown(false,false,m);f.cellUndoable.add(s.children());f.setDirty(true);f.evt.cellEditDone(true)},evt:{keyDownHandler:{enterOnInPlaceEdit:function(h){if(!h.shiftKey){return f.evt.cellSetFocusFromKeyCode(h)}else{return true}},enter:function(h){if(!f.cellLast.isEdit&&!h.ctrlKey){f.cellLast.td.dblclick();return false}else{return this.enterOnInPlaceEdit(h)}},tab:function(h){return f.evt.cellSetFocusFromKeyCode(h)},findCell:function(h){if(h.ctrlKey){f.cellFind();return false}return true},redo:function(h){if(h.ctrlKey&&!f.cellLast.isEdit){f.cellUndoable.undoOrRedo();return false}return true},undo:function(h){if(h.ctrlKey&&!f.cellLast.isEdit){f.cellUndoable.undoOrRedo(true);return false}return true},pageUpDown:function(h){var k=f.obj.pane();var j=f.cellLast.td.position().left;var i=0;if(h){i=0;k.scrollTop(k.scrollTop()-k.height())}else{i=k.height()-(d.colMargin*3);k.scrollTop(k.scrollTop()+i)}return f.evt.cellSetFocusFromXY(j,i)},formulaKeydown:function(h){if(f.readOnly[f.i]){return false}if(f.cellLast.row<0||f.cellLast.col<0){return false}switch(h.keyCode){case key.ESCAPE:f.evt.cellEditAbandon();break;case key.ENTER:f.evt.cellSetFocusFromKeyCode(h);return false;break;default:f.cellLast.isEdit=true}},formulaKeydownIf:function(i,h){if(i){f.obj.cellActive().dblclick();return true}return false},documentKeydown:function(h){if(document.jSKeydownSkip){return true}if(f.readOnly[f.i]){return false}if(f.cellLast.row<0||f.cellLast.col<0){return false}if(f.nav){switch(h.keyCode){case key.TAB:f.evt.keyDownHandler.tab(h);break;case key.ENTER:case key.LEFT:case key.UP:case key.RIGHT:case key.DOWN:(h.shiftKey?f.evt.cellSetHighlightFromKeyCode(h):f.evt.cellSetFocusFromKeyCode(h));break;case key.PAGE_UP:f.evt.keyDownHandler.pageUpDown(true);break;case key.PAGE_DOWN:f.evt.keyDownHandler.pageUpDown();break;case key.HOME:case key.END:f.evt.cellSetFocusFromKeyCode(h);break;case key.V:return f.evt.keyDownHandler.formulaKeydownIf(!f.evt.pasteOverCells(h),h);break;case key.Y:return f.evt.keyDownHandler.formulaKeydownIf(!f.evt.keyDownHandler.redo(h),h);break;case key.Z:return f.evt.keyDownHandler.formulaKeydownIf(!f.evt.keyDownHandler.undo(h),h);break;case key.ESCAPE:f.evt.cellEditAbandon();break;case key.F:return f.evt.keyDownHandler.formulaKeydownIf(f.evt.keyDownHandler.findCell(h),h);break;case key.CONTROL:case key.CAPS_LOCK:case key.SHIFT:case key.ALT:f.obj.formula().focus().select();return true;break;default:f.obj.cellActive().dblclick();return true}return false}}},pasteOverCells:function(j){if(j.ctrlKey||j.type=="paste"){var i=function(){f.updateCellsAfterPasteToFormula()};var h=jQuery(document).one("keyup",function(){i();i=function(){};h.mouseup()}).one("mouseup",function(){i();i=function(){};h.keyup()});f.setDirty(true);return true}},inPlaceEditOnKeyDown:function(h){switch(h.keyCode){case key.ENTER:return f.evt.keyDownHandler.enterOnInPlaceEdit(h);break;case key.TAB:return f.evt.keyDownHandler.tab(h);break;case key.ESCAPE:f.evt.cellEditAbandon();return false;break}},formulaChange:function(h){f.obj.inPlaceEdit().val(f.obj.formula().val())},inPlaceEditChange:function(h){f.obj.formula().val(f.obj.inPlaceEdit().val())},cellEditDone:function(j){switch(f.cellLast.isEdit||j){case true:f.obj.inPlaceEdit().remove();var m=f.obj.formula();var l=f.cellLast.td;switch(f.isFormulaEditable(l)){case true:if(l&&f.cellLast.row>-1&&f.cellLast.col>-1){f.cellUndoable.add(l);var i=m.val();var k=l.text();var h=f.spreadsheets[f.i][f.cellLast.row][f.cellLast.col];if(i.charAt(0)=="="){l.attr("formula",i).html("");h.value=i;h.formula=i}else{l.removeAttr("formula").html(i);h.value=i;h.formula=null}h.calcCount=0;if(i!=k||j){f.calc()}f.attrH.setHeight(f.cellLast.row,"cell");f.cellUndoable.add(l);f.cellLast.isEdit=false;f.setDirty(true);f.trigger("afterCellEdit",[{td:f.cellLast.td,row:f.cellLast.row,col:f.cellLast.col,spreadsheetIndex:f.i,sheetIndex:c}])}}break;default:f.attrH.setHeight(f.cellLast.row,"cell",false)}},cellEditAbandon:function(h){f.obj.inPlaceEdit().remove();f.themeRoller.cell.clearActive();f.themeRoller.bar.clearActive();f.themeRoller.cell.clearHighlighted();if(!h){f.calc()}f.cellLast.td=jQuery("<td />");f.cellLast.row=-1;f.cellLast.col=-1;f.rowLast=-1;f.colLast=-1;f.labelUpdate("",true);f.obj.formula().val("");if(d.autoFiller){f.obj.autoFiller().hide()}return false},cellSetFocusFromXY:function(i,h,j){var k=f.getTdFromXY(i,h,j);if(f.isTd(k)){f.themeRoller.cell.clearHighlighted();f.cellEdit(k);return false}else{return true}},cellSetHighlightFromKeyCode:function(k){var l=f.highlightedLast.colLast;var j=f.highlightedLast.rowLast;var h=f.sheetSize();jQuery(f.cellLast.td).mousedown();switch(k.keyCode){case key.UP:j--;break;case key.DOWN:j++;break;case key.LEFT:l--;break;case key.RIGHT:l++;break}function i(n,m){if(n<0){return 0}if(n>m){return m}return n}j=i(j,h.height);l=i(l,h.width);td=f.getTd(f.i,j,l);jQuery(td).mousemove().mouseup();f.highlightedLast.rowLast=j;f.highlightedLast.colLast=l;return false},cellSetFocusFromKeyCode:function(l){var o=f.cellLast.col;var i=f.cellLast.row;var k=false;switch(l.keyCode){case key.UP:i--;break;case key.DOWN:i++;break;case key.LEFT:o--;break;case key.RIGHT:o++;break;case key.ENTER:i++;k=true;if(f.highlightedLast.td.length>1){var j=f.obj.inPlaceEdit();var h=j.val();j.remove();f.updateCellsAfterPasteToFormula(h);return true}else{if(d.autoAddCells){if(f.cellLast.row==f.sheetSize().height){f.controlFactory.addRow(":last")}}}break;case key.TAB:k=true;if(l.shiftKey){o--}else{o++}if(d.autoAddCells){if(f.cellLast.col==f.sheetSize().width){f.controlFactory.addColumn(":last")}}break;case key.HOME:o=0;break;case key.END:o=f.cellLast.td.parent().find("td").length-1;break}o=(o<0?0:o);i=(i<0?0:i);if(!f.cellLast.isEdit||k){var n=f.getTd(f.i,i,o);if(n){f.themeRoller.cell.clearHighlighted();n=jQuery(n);if(n.is(":hidden")){function m(q,p){if(p){o++;q=q.next()}else{o--;q=q.prev()}if(q.is(":hidden")&&q.length){return m(q,p)}return q}n=m(n,o>f.cellLast.col)}f.cellEdit(n);return false}}return true},cellOnMouseDown:function(h){f.obj.formula().blur();if(h.shiftKey){f.getTdRange(h,f.obj.formula().val())}else{f.cellEdit(jQuery(h.target),true)}},cellOnDblClick:function(h){f.cellLast.isEdit=f.isSheetEdit=true;f.controlFactory.inPlaceEdit(f.cellLast.td)},scrollBars:function(i){var h={barLeft:f.obj.barLeftParent(),barTop:f.obj.barTopParent()};i.scroll(function(){h.barTop.scrollLeft(i.scrollLeft());h.barLeft.scrollTop(i.scrollTop());f.trigger("paneScroll")})},barMouseDown:{select:function(i,h,j){j(h.target);i.unbind("mouseover").mouseover(function(k){j(k.target)});jQuery(document).one("mouseup",function(){i.unbind("mouseover").unbind("mouseup")});return false},first:0,last:0,height:function(i){var h=function(){};i.unbind("mousedown").mousedown(function(k){var j=f.getBarLeftIndex(k.target);if(j==-1){return false}f.evt.barMouseDown.first=f.evt.barMouseDown.last=f.rowLast=j;f.evt.barMouseDown.select(i,k,h);return false}).bind("contextmenu",function(k){if(!f.isSheetEditable()){return false}var j=f.getBarLeftIndex(k.target);if(j==-1){return false}i.parent().mousedown().mouseup();f.controlFactory.barLeftMenu(k,j);return false}).parent().mouseover(function(k){if(jQuery(k.target).attr("id")){return false}var j=f.getBarLeftIndex(k.target);if(j==-1){return false}f.resizeBarLeft(k);if(f.isSheetEditable()){f.controlFactory.barLeftHandle(i,j)}});if(f.isSheetEditable()){h=function(k){if(!k){return false}if(jQuery(k).attr("id")){return false}var j=f.getBarLeftIndex(k);if(j==-1){return false}f.rowLast=j;f.evt.barMouseDown.last=j;f.cellSetActiveBar("row",f.evt.barMouseDown.first,f.evt.barMouseDown.last)}}},width:function(j){var h=function(){};var i=0;j.unbind("mousedown").mousedown(function(l){var k=f.getBarTopIndex(l.target);if(k==-1){return false}f.evt.barMouseDown.first=f.evt.barMouseDown.last=f.colLast=k;f.evt.barMouseDown.select(j,l,h);return false}).bind("contextmenu",function(l){if(!f.isSheetEditable()){return false}var k=f.getBarTopIndex(l.target);if(k==-1){return false}j.parent().mousedown().mouseup();f.controlFactory.barTopMenu(l,k);return false}).parent().mouseover(function(l){if(jQuery(l.target).attr("id")){return false}var k=f.getBarTopIndex(l.target);if(k==-1){return false}f.resizeBarTop(l);if(f.isSheetEditable()){f.controlFactory.barTopHandle(j,k);f.controlFactory.barTopMenu(l,k,jQuery(l.target))}return false});if(f.isSheetEditable()){h=function(l){if(!l){return false}if(jQuery(l).attr("id")){return false}var k=f.getBarTopIndex(l);if(k==-1){return false}f.colLast=k;f.evt.barMouseDown.last=k;f.cellSetActiveBar("col",f.evt.barMouseDown.first,f.evt.barMouseDown.last)}}}}},isTd:function(h){h=(h[0]?h[0]:[h]);if(h[0]){if(!isNaN(h[0].cellIndex)){return true}}return false},readOnly:[],isSheetEditable:function(h){h=(h==null?f.i:h);return(d.editable==true&&!f.readOnly[h])},isFormulaEditable:function(h){if(d.lockFormulas){if(h.attr("formula")!==undefined){return false}}return true},toggleFullScreen:function(){if(f.obj.fullScreen().is(":visible")){jQuery("body").removeClass("bodyNoScroll");d.parent=b;var i=d.parent.width();var j=d.parent.height();d.width=i;d.height=j;f.obj.tabContainer().insertAfter(d.parent.append(f.obj.fullScreen().children())).removeClass(f.cl.tabContainerFullScreen);f.obj.fullScreen().remove();f.sheetSyncSize()}else{jQuery("body").addClass("bodyNoScroll");var i=g.width()-15;var j=g.height()-35;d.width=i;d.height=j;f.obj.tabContainer().insertAfter(jQuery('<div class="'+f.cl.fullScreen+" "+f.cl.uiFullScreen+'" />').append(d.parent.children()).appendTo("body")).addClass(f.cl.tabContainerFullScreen);d.parent=f.obj.fullScreen();f.sheetSyncSize()}},renameSpreadsheet:function(h){if(isNaN(h)){return false}if(h>-1){f.sheetTab()}},switchSpreadsheet:function(h){if(isNaN(h)){return false}if(h==-1){f.addSheet("5x10")}else{if(h!=f.i){f.setActiveSheet(h);f.calc(h)}}f.trigger("switchSheet",[h]);return false},tuneTableForSheetUse:function(h){h.addClass(f.cl.sheet).attr("id",f.id.sheet+f.i).attr("border","1px").attr("cellpadding","0").attr("cellspacing","0");h.find("td."+f.cl.cellActive).removeClass(f.cl.cellActive);return h},attrH:{width:function(i,h){return jQuery(i).outerWidth()-(h?0:d.boxModelCorrection)},widthReverse:function(i,h){return jQuery(i).outerWidth()+(h?0:d.boxModelCorrection)},height:function(i,h){return jQuery(i).outerHeight()-(h?0:d.boxModelCorrection)},heightReverse:function(i,h){return jQuery(i).outerHeight()+(h?0:d.boxModelCorrection)},syncSheetWidthFromTds:function(i){var h=0;i=(i?i:f.obj.sheet());i.find("col").each(function(){h+=jQuery(this).width()});i.width(h);return h},setHeight:function(m,s,l,j){var p=0;var n=0;var r;switch(s){case"cell":j=(j?j:f.obj.barLeft().children().eq(m));n=f.attrH.height(jQuery(f.getTd(f.i,m,0)).parent().andSelf(),l);break;case"bar":if(!j){var q=jQuery(f.getTd(f.i,m,0)).parent();var k=q.children();j=q.add(k)}n=f.attrH.heightReverse(f.obj.barLeft().children().eq(m),l);break}if(n){jQuery(j).height(n).css("height",n+"px").attr("height",n+"px")}return j}},setTdIds:function(j,h){if(!j){j=f.obj.sheet();h=f.i}f.spreadsheets[h]=[];j.find("tr").each(function(i){jQuery(this).children().each(function(k){var l=jQuery(this).attr("id",f.getTdId(h,i,k));f.createCell(h,i,k,l.text(),l.attr("formula"))})})},setControlIds:function(){var h=function(i,j){i.each(function(k){jQuery(this).attr("id",j+k)})};h(f.obj.sheetAll().each(function(j){f.setTdIds(jQuery(this),j)}),f.id.sheet);h(f.obj.barTopAll(),f.id.barTop);h(f.obj.barTopParentAll(),f.id.barTopParent);h(f.obj.barLeftAll(),f.id.barLeft);h(f.obj.barLeftParentAll(),f.id.barLeftParent);h(f.obj.barCornerAll(),f.id.barCorner);h(f.obj.barCornerParentAll(),f.id.barCornerParent);h(f.obj.tableControlAll(),f.id.tableControl);h(f.obj.paneAll(),f.id.pane);h(f.obj.tabAll().each(function(i){jQuery(this).attr("i",i)}),f.id.tab)},toggleHide:{row:function(h){if(!h){h=f.obj.cellActive().parent().attr("rowIndex")}if(h){var j=f.obj.barLeft().children().eq(h);if(j.is(":visible")){j.hide();f.obj.sheet().find("tr").eq(h).hide()}else{j.show();f.obj.sheet().find("tr").eq(h).show()}}else{alert(f.msg.toggleHideRow)}},rowAll:function(){f.obj.sheet().find("tr").show();f.obj.barLeft().children().show()},column:function(h){if(!h){h=f.obj.cellActive().attr("cellIndex")}if(h){var j=f.obj.barTop().children().eq(h);if(j.is(":visible")){f.obj.sheet().find("tbody tr").each(function(){jQuery(this).children().eq(h).hide()});j.hide();f.obj.sheet().find("colgroup col").eq(h).hide();f.toggleHide.columnSizeManage()}}else{alert(f.msg.toggleHideColumn)}},columnAll:function(){},columnSizeManage:function(){var h=f.obj.barTop().width();var i=0;var i=0;f.obj.barTop().children().each(function(){var j=jQuery(this);if(j.is(":hidden")){i+=j.width()}});f.obj.barTop().width(h);f.obj.sheet().width(h)}},merge:function(){var l="";var q="";var r=f.obj.cellHighlighted();var o;var h=f.getTdLocation(r.first());var j=f.getTdLocation(r.last());var n=(j.col-h.col)+1;if(r.length>1&&h.row){for(var m=h.col;m<=j.col;m++){var k=jQuery(f.getTd(f.i,h.row,m)).hide();var p=f.spreadsheets[f.i][h.row][m];l=(p.formula?"("+p.formula.replace("=","")+")":p.value)+l;if(m!=h.col){p.formula=null;p.value;k.attr("formula","").html("").hide()}}var p=r.first().show().attr("colspan",n).html(l);f.setDirty(true);f.calc()}else{if(!h.row){alert(f.msg.merge)}}},unmerge:function(){var q=f.obj.cellHighlighted().first();var l=f.getTdLocation(q);var n=q.attr("formula");var p=q.text();p=(n?n:p);var o=q.attr("rowspan");var m=q.attr("colspan");m=parseInt(m?m:1);var h="<td />";var k="";if(m){for(var j=0;j<m;j++){k+=h}}for(var j=l.col;j<m;j++){jQuery(f.getTd(f.i,l.row,j)).show()}q.removeAttr("colspan");f.setDirty(true);f.calc()},fillUpOrDown:function(o,n,p){var r=f.obj.cellHighlighted();var h=f.obj.cellActive();f.cellUndoable.add(r);var q=h.hasClass(f.cl.uiCellHighlighted);var l=f.getTdLocation(r.first());var s=f.getTdLocation(r.last());p=(p?p:f.obj.formula().val());var k={row:0,col:0};var j;var i=p;var m;if(p.charAt(0)=="="){m=function(u,v,t){j=jQuery(this);if(o){k.row=-s.row+v;k.col=-s.col+t}else{k.row=v-l.row;k.col=t-l.col}i=f.reparseFormula(p,k);f.spreadsheets[u][v][t].formula=i;j.attr("formula",i).html("")}}else{if(o&&!isNaN(i)){i*=1;i-=s.row;i-=s.col}m=function(u,v,t){j=jQuery(this);f.spreadsheets[u][v][t].formula=null;f.spreadsheets[u][v][t].value=i;j.removeAttr("formula").html(i);if(!isNaN(i)&&i!=""){i++}}}f.cycleCells(m,l,s);f.setDirty(true);f.calc();f.cellUndoable.add(r)},offsetFormulas:function(n,m,i){var h=f.sheetSize();var l={first:n,last:{row:h.height,col:h.width}};var j={first:{row:0,col:0},last:{row:h.height,col:h.width}};f.log("offsetFormulas from - Col:"+n.col+",Row:"+n.row);f.log("Is before loc:"+(i?"true":"false"));f.log("Offset: - Col:"+m.col+",Row:"+m.row);function k(q,o){var p=false;if(i){if(q>=o){p=true}}else{if(q>o){p=true}}return p}f.cycleCells(function(p,q,o){var s=jQuery(this);var r=s.attr("formula");if(r&&f.isFormulaEditable(s)){r=f.reparseFormula(r,m,function(t){return{row:k(t.row,n.row),col:k(t.col,n.col)}});f.spreadsheets[p][q][o].formula=r;s.attr("formula",r)}},j.first,j.last);f.evt.cellEditDone();f.calc()},reparseFormula:function(j,i,h){return j.replace(jSE.regEx.cell,function(l,m,o,p){if(m=="SHEET"){return l}var n=jSE.parseLocation(l);if(h){var k=h(n);if(k.col||k.row){if(k.col){n.col+=i.col}if(k.row){n.row+=i.row}return f.makeFormula(n)}}else{return f.makeFormula(n,i)}return l})},makeFormula:function(i,h){h=jQuery.extend({row:0,col:0},h);i.col+=h.col;i.row+=h.row;if(i.col<0){i.col=0}if(i.row<0){i.row=0}return jSE.parseCellName(i.col,i.row)},cycleCells:function(k,n,l,j){j=(j?j:f.i);n=(n?n:{row:0,col:0});if(!l){var i=f.sheetSize(jQuery("#"+f.id.sheet+j));l={row:i.height,col:i.width}}for(var m=n.row;m<=l.row;m++){for(var h=n.col;h<=l.col;h++){var o=f.getTd(j,m,h);if(o){k.apply(o,[j,m,h])}}}},cycleCellsAll:function(l){for(var k=0;k<=f.sheetCount;k++){var j=f.sheetSize(jQuery("#"+f.id.sheet+k));var h={row:j.height,col:j.width};f.cycleCells(l,{row:0,col:0},h,k)}},cycleCellsAndMaintainPoint:function(l,p,m){var n=[];for(var k=(p.row<m.row?p.row:m.row);k<=(p.row>m.row?p.row:m.row);k++){for(var h=(p.col<m.col?p.col:m.col);h<=(p.col>m.col?p.col:m.col);h++){n.push(f.getTd(f.i,k,h));l(n[n.length-1])}}return n},addTab:function(){jQuery('<span class="'+f.cl.uiTab+' ui-corner-bottom"><a class="'+f.cl.tab+'" id="'+f.id.tab+f.i+'" i="'+f.i+'">'+f.sheetTab(true)+"</a></span>").insertBefore(f.obj.tabContainer().find("span:last"))},sheetDecorate:function(h){f.formatSheet(h);f.sheetSyncSizeToCols(h);f.sheetDecorateRemove()},formatSheet:function(j){var h=0;if(j.find("tbody").length<1){j.wrapInner("<tbody />")}if(j.find("colgroup").length<1||j.find("col").length<1){j.remove("colgroup");var i=jQuery("<colgroup />");j.find("tr:first").children().each(function(){var k=d.newColumnWidth;jQuery("<col />").width(k).css("width",(k)+"px").attr("width",(k)+"px").appendTo(i);h+=k});j.find("tr").each(function(){jQuery(this).height(d.colMargin).css("height",d.colMargin+"px").attr("height",d.colMargin+"px")});i.prependTo(j)}j.removeAttr("width").css("width","").width(h)},checkMinSize:function(j){var i=f.sheetSize();var k=0;var h=0;if((i.width)<d.minSize.cols){h=d.minSize.cols-i.width-1}if(h){f.controlFactory.addColumnMulti(h,false,true)}if((i.height)<d.minSize.rows){k=d.minSize.rows-i.height-1}if(k){f.controlFactory.addRowMulti(k,false,true)}},themeRoller:{start:function(){d.parent.addClass(f.cl.uiParent);f.obj.sheet().addClass(f.cl.uiSheet);f.obj.barLeft().children().addClass(f.cl.uiBar);f.obj.barTop().children().addClass(f.cl.uiBar);f.obj.barCornerParent().addClass(f.cl.uiBar);f.obj.controls().addClass(f.cl.uiControl);f.obj.label().addClass(f.cl.uiControl);f.obj.formula().addClass(f.cl.uiControlTextBox)},cell:{setActive:function(){this.clearActive();this.setHighlighted(f.cellLast.td.addClass(f.cl.cellActive))},setHighlighted:function(h){jQuery(h).addClass(f.cl.cellHighlighted+" "+f.cl.uiCellHighlighted)},clearActive:function(){f.obj.cellActive().removeClass(f.cl.cellActive)},isHighlighted:function(){return(f.highlightedLast.td?true:false)},clearHighlighted:function(){if(f.themeRoller.cell.isHighlighted()){f.obj.cellHighlighted().removeClass(f.cl.cellHighlighted+" "+f.cl.uiCellHighlighted)}f.highlightedLast.rowStart=-1;f.highlightedLast.colStart=-1;f.highlightedLast.rowEnd=-1;f.highlightedLast.colEnd=-1;f.highlightedLast.td=jQuery("<td />")}},bar:{style:function(h){jQuery(h).addClass(f.cl.uiBar)},setActive:function(j,h){switch(j){case"top":f.obj.barTop().children().eq(h).addClass(f.cl.uiActive);break;case"left":f.obj.barLeft().children().eq(h).addClass(f.cl.uiActive);break}},clearActive:function(){f.obj.barTop().add(f.obj.barLeft()).children("."+f.cl.uiActive).removeClass(f.cl.uiActive)}},tab:{setActive:function(h){this.clearActive();f.obj.tab().parent().addClass(f.cl.uiTabActive)},clearActive:function(){f.obj.tabContainer().find("span."+f.cl.uiTabActive).removeClass(f.cl.uiTabActive)}},resize:function(){f.resizable(d.parent,{minWidth:d.width*0.5,minHeight:d.height*0.5,start:function(){f.obj.ui().hide()},stop:function(){f.obj.ui().show();d.width=d.parent.width();d.height=d.parent.height();f.sheetSyncSize()}});var h=jQuery("<span />");f.resizable(f.obj.formula().wrap(h).parent(),{minHeight:f.obj.formula().height(),maxHeight:78,handles:"s",resize:function(j,i){f.obj.formula().height(i.size.height);f.sheetSyncSize()}})}},resizable:function(i,h){if(!i.resizable){return}if(i.attr("resizable")){i.resizable("destroy")}i.resizable(h).attr("resizable",true)},busy:false,draggable:function(i,h){if(i.attr("draggable")){i.resizable("destroy")}i.draggable(h).attr("draggable",true)},resizeBarTop:function(h){f.resizable(jQuery(h.target),{handles:"e",start:function(){f.busy=true;f.obj.barHelper().remove()},stop:function(m,l){f.busy=false;var k=f.getBarTopIndex(this);f.sheetSyncSizeToDivs();var j=f.attrH.width(this,true);f.obj.sheet().find("col").eq(k).width(j).css("width",j+"px").attr("width",j+"px");f.followMe();f.obj.pane().scroll()}})},resizeBarLeft:function(h){f.resizable(jQuery(h.target),{handles:"s",start:function(){f.busy=true;f.obj.barHelper().remove()},stop:function(l,k){f.busy=false;var j=f.getBarLeftIndex(jQuery(this));f.attrH.setHeight(j,"bar",true);f.attrH.setHeight(j,"cell");f.followMe();f.obj.pane().scroll()}})},sheetDecorateRemove:function(i){var h=(i?f.obj.sheetAll().clone():f.obj.sheetAll());jQuery(h).find("td."+f.cl.cellActive).removeClass(f.cl.cellActive+" "+f.cl.uiCellActive);jQuery(h).find("td."+f.cl.cellHighlighted).removeClass(f.cl.cellHighlighted+" "+f.cl.uiCellHighlighted);return h},labelUpdate:function(i,h){if(!h){f.obj.label().html(jSE.parseCellName(i.col,i.row))}else{f.obj.label().html(i)}},cellEdit:function(m,i,j){f.autoFillerNotGroup=true;f.evt.cellEditDone();f.followMe(m);f.obj.pane().scroll();var k=f.getTdLocation(m);f.labelUpdate(k);var h=m.attr("formula");if(!h){h=m.text()}var l=f.obj.formula().val(h).blur();if(!j){}f.cellSetActive(m,k,i)},cellSetActive:function(o,n,k,i,m){if(typeof(n.col)!="undefined"){f.cellLast.td=o;f.cellLast.row=f.rowLast=n.row;f.cellLast.col=f.colLast=n.col;f.themeRoller.bar.clearActive();f.themeRoller.cell.clearHighlighted();f.highlightedLast.td=o;f.themeRoller.cell.setActive();f.themeRoller.bar.setActive("left",f.cellLast.row);f.themeRoller.bar.setActive("top",f.cellLast.col);var h;var l;f.highlightedLast.rowStart=n.row;f.highlightedLast.colStart=n.col;f.highlightedLast.rowLast=n.row;f.highlightedLast.colLast=n.col;switch(d.cellSelectModel){case"excel":case"gdocs":h=function(){};l=f.themeRoller.cell.clearHighlighted;break;case"oo":h=function(p){var q=jQuery(p);if(f.isTd(q)){f.cellEdit(q)}};l=function(){};break}if(k){var j=n;f.obj.pane().mousemove(function(r){var p=f.getTdLocation([r.target]);var q=true;if(i){q=false;if(n.col==p.col||n.row==p.row){q=true}}if((j.col!=p.col||j.row!=p.row)&&q){l();f.highlightedLast.colEnd=p.col;f.highlightedLast.rowEnd=p.row;h(r.target);f.highlightedLast.td=f.cycleCellsAndMaintainPoint(f.themeRoller.cell.setHighlighted,n,p)}j=p});jQuery(document).one("mouseup",function(){f.obj.pane().unbind("mousemove").unbind("mouseup");if(jQuery.isFunction(m)){m()}})}}},colLast:0,rowLast:0,cellLast:{td:jQuery("<td />"),row:-1,col:-1,isEdit:false},highlightedLast:{td:jQuery("<td />"),rowStart:-1,colStart:-1,rowEnd:-1,colEnd:-1},cellStyleToggle:function(j,i){var h=f.obj.cellHighlighted();f.cellUndoable.add(h);if(i){h.removeClass(i)}if(h.hasClass(j)){h.removeClass(j)}else{h.addClass(j)}f.cellUndoable.add(h);return false},fontReSize:function(j){var h=0;switch(j){case"up":h=1;break;case"down":h=-1;break}var i=f.obj.cellHighlighted();f.cellUndoable.add(i);i.each(function(l){cell=jQuery(this);var k=(cell.css("font-size")+"").replace("px","");var m=parseInt(k?k:10)+h;cell.css("font-size",m+"px")});f.cellUndoable.add(i)},callStack:0,updateCellValue:function(j,m,i){if(!f.spreadsheets[j]){return"Error: Sheet not found"}if(!f.spreadsheets[j][m]){return"Error: Row not found"}if(!f.spreadsheets[j][m][i]){return"Error: Column not found"}var h=f.spreadsheets[j][m][i];h.oldValue=h.value;if(h.state){throw ("Error: Loop Detected")}h.state="red";h.html="";if(h.calcCount<1&&h.calcLast!=f.calcLast){h.calcLast=f.calcLast;h.calcCount++;if(h.formula){try{if(h.formula.charAt(0)=="="){h.formula=h.formula.substring(1,h.formula.length)}var l;if(f.callStack){if(!h.parser){h.parser=(new f.parser)}l=h.parser}else{l=f.Parser}f.callStack++;l.lexer.cell={sheet:j,row:m,col:i,cell:h,s:d,editable:d.editable,jS:f};l.lexer.cellHandler=f.cellHandlers;h.value=l.parse(h.formula)}catch(k){h.value=k.toString().replace(/\n/g,"<br />");b.one("calculation",function(){f.attrH.setHeight(m,"cell",false)});f.alertFormulaError(h.value)}f.callStack--}if(h.html){jQuery(f.getTd(j,m,i)).html(h.html)}else{jQuery(f.getTd(j,m,i)).html(h.value)}}h.state=null;return h.value},cellHandlers:{cellValue:function(i){var h=jSE.parseLocation(i);return f.updateCellValue(this.sheet,h.row,h.col)},cellRangeValue:function(n,k){n=jSE.parseLocation(n);k=jSE.parseLocation(k);var h=[];for(var m=n.row;m<=k.row;m++){for(var l=n.col;l<=k.col;l++){h.push(f.updateCellValue(this.sheet,m,l))}}return[h]},fixedCellValue:function(h){h=h.replace(/\$/g,"");return f.cellHandlers.cellValue.apply(this,[h])},fixedCellRangeValue:function(i,h){i=i.replace(/\$/g,"");h=h.replace(/\$/g,"");return f.cellHandlers.cellRangeValue.apply(this,[i,h])},remoteCellValue:function(h,j){var i=jSE.parseLocation(j);h=((h+"").replace("SHEET","")*1)-1;return f.updateCellValue(h,i.row,i.col)},remoteCellRangeValue:function(n,o,k){n=((n+"").replace("SHEET","")*1)-1;o=jSE.parseLocation(o);k=jSE.parseLocation(k);var h=[];for(var m=o.row;m<=k.row;m++){for(var l=o.col;l<=k.col;l++){h.push(f.updateCellValue(n,m,l))}}return[h]},callFunction:function(j,i,h){if(!i){i=[""]}else{if(jQuery.isArray(i)){i=i.reverse()}else{i=[i]}}return(jQuery.sheet.fn[j]?jQuery.sheet.fn[j].apply(h,i):"Error: Function Not Found")}},alertFormulaError:function(h){alert("cell:"+row+" ;"+col+'\nvalue: "'+cell.formula+'"\nerror: \n'+e)},context:{},calcLast:0,calc:function(h){h=(h?h:f.i);if(f.readOnly[h]){return}f.log("Calculation Started");f.calcLast=new Date();jSE.calc(h,f.spreadsheetsToArray()[h],f.updateCellValue);f.trigger("calculation");f.isSheetEdit=false;f.log("Calculation Ended")},refreshLabelsColumns:function(){var h=0;f.obj.barTop().children().each(function(j){jQuery(this).text(jSE.columnLabelString(j));h+=jQuery(this).width()});return h},refreshLabelsRows:function(){f.obj.barLeft().children().each(function(h){jQuery(this).text((h+1))})},addSheet:function(h){h=(h?h:prompt(f.msg.newSheet));if(h){f.evt.cellEditAbandon();f.setDirty(true);var i=f.controlFactory.sheetUI(jQuery.sheet.makeTable.fromSize(h),f.sheetCount+1,function(j){f.setActiveSheet(f.sheetCount)},true);f.trigger("addSheet",[f.i])}},deleteSheet:function(){var h=f.i;f.obj.barHelper().remove();f.obj.tableControl().remove();f.obj.tabContainer().children().eq(f.i).remove();f.i=0;f.sheetCount--;f.setControlIds();f.setActiveSheet(f.i);f.setDirty(true);f.trigger("deleteSheet",[h])},deleteRow:function(h){var i=f.rowLast;f.obj.barLeft().children().eq(f.rowLast).remove();jQuery(f.getTd(f.i,f.rowLast,0)).parent().remove();f.refreshLabelsRows();f.setTdIds();f.obj.pane().scroll();f.offsetFormulas({row:f.rowLast,col:0},{row:-1,col:0});f.setDirty(true);f.evt.cellEditAbandon();f.trigger("deleteRow",i)},deleteColumn:function(j){var m=f.colLast;f.obj.barHelper().remove();f.obj.barTop().children().eq(f.colLast).remove();f.obj.sheet().find("colgroup col").eq(f.colLast).remove();var l=f.sheetSize();for(var k=0;k<=l.height;k++){jQuery(f.getTd(f.i,k,f.colLast)).remove()}var h=f.refreshLabelsColumns();f.setTdIds();f.obj.sheet().width(h);f.obj.pane().scroll();f.offsetFormulas({row:0,col:f.colLast},{row:0,col:-1});f.setDirty(true);f.evt.cellEditAbandon();f.trigger("deleteColumn",lastCol)},sheetTab:function(i){var h="";if(i){h=f.obj.sheet().attr("title");h=(h?h:"Spreadsheet "+(f.i+1))}else{if(f.isSheetEditable()&&d.editableTabs){var j=prompt("What would you like the sheet's title to be?",f.sheetTab(true));if(!j){h=f.obj.sheet().attr("title");j=(h?h:"Spreadsheet"+(f.i+1))}else{f.setDirty(true);f.obj.sheet().attr("title",j);f.obj.tab().html(j);h=j}}}return jQuery("<div />").text(h).html()},print:function(i){var h=window.open();h.document.write("<html><body><xmp>"+i+"\n</xmp></body></html>");h.document.close()},viewSource:function(i){var j=f.sheetDecorateRemove(true);var h="";if(i){jQuery(j).each(function(){h+=f.HTMLtoPrettySource(this)})}else{h+=jQuery("<div />").html(j).html()}f.print(h);return false},saveSheet:function(){var h=f.sheetDecorateRemove(true);var i=jQuery("<div />").html(h).html();jQuery.ajax({url:d.urlSave,type:"POST",data:"s="+i,dataType:"html",success:function(j){f.setDirty(false);f.trigger("saveSheet")}})},HTMLtoCompactSource:function(o){var j="";if(o.nodeType==1){j+="<"+o.tagName;l=false;var q=o.attributes.length;for(var m=0,l=false;m<q;m++){var k=o.attributes[m].name;var p=o.getAttribute(k);if(p){if(k=="contentEditable"&&p=="inherit"){continue}if(k=="class"){l=true}if(typeof(p)=="string"){j+=" "+k+'="'+p.replace(/"/g,"'")+'"'}else{if(k=="style"&&p.cssText){j+=' style="'+p.cssText+'"'}}}}if(o.tagName=="COL"){j+="/>"}else{j+=">";var h="";jQuery(o.childNodes).each(function(){h+=f.HTMLtoCompactSource(this)});j+=h;j+="</"+o.tagName+">"}}else{if(o.nodeType==3){j+=o.data.replace(/^\s*(.*)\s*$/g,"$1")}}return j},HTMLtoPrettySource:function(m,o){if(!o){o=""}var j="";if(m.nodeType==1){j+="\n"+o+"<"+m.tagName;var q=m.attributes.length;for(var l=0;l<q;l++){var k=m.attributes[l].name;var p=m.getAttribute(k);if(p){if(k=="contentEditable"&&p=="inherit"){continue}if(typeof(p)=="string"){j+=" "+k+'="'+p.replace(/"/g,"'")+'"'}else{if(k=="style"&&p.cssText){j+=' style="'+p.cssText+'"'}}}}if(m.childNodes.length<=0){j+="/>"}else{j+=">";var h="";var q=m.childNodes.length;for(var l=0;l<q;l++){h+=f.HTMLtoPrettySource(m.childNodes[l],o+"  ")}j+=h;if(h.indexOf("\n")>=0){j+="\n"+o}j+="</"+m.tagName+">"}}else{if(m.nodeType==3){j+=m.data.replace(/^\s*(.*)\s*$/g,"$1")}}return j},followMe:function(j){j=(j?j:jQuery(f.cellLast.td));var i=f.obj.pane();var l=i.offset();var p=i.width();var h=i.height();var o=j.offset();var n=j.width();var m=j.height();var k=20;if((o.left+n+k)>(l.left+p)){i.stop().scrollTo(j,{axis:"x",duration:50,offset:-((p-n)-k)})}else{if(o.left<l.left){i.stop().scrollTo(j,{axis:"x",duration:50})}}if((o.top+m+k)>(l.top+h)){i.stop().scrollTo(j,{axis:"y",duration:50,offset:-((h-m)-k)})}else{if(o.top<l.top){i.stop().scrollTo(j,{axis:"y",duration:50})}}f.autoFillerGoToTd(j,m,n)},autoFillerGoToTd:function(j,h,i){j=(j?j:jQuery(f.cellLast.td));h=(h?h:j.height());i=(i?i:j.width());if(d.autoFiller){if(j.attr("id")){tdPos=j.position();f.obj.autoFiller().show().css("top",((tdPos.top+(h?h:j.height())-3)+"px")).css("left",((tdPos.left+(i?i:j.width())-3)+"px"))}}},isRowHeightSync:[],setActiveSheet:function(h){h=(h?h:0);if(f.cellLast.row>-1||f.cellLast.col>-1){f.evt.cellEditDone();f.obj.formula().val("")}f.obj.tableControlAll().hide().eq(h).show();f.i=h;f.themeRoller.tab.setActive();if(!f.isRowHeightSync[h]){f.isRowHeightSync[h]=true;f.obj.sheet().find("tr").each(function(i){f.attrH.setHeight(i,"cell")})}f.readOnly[h]=f.obj.sheet().hasClass("readonly");f.sheetSyncSize()},openSheetURL:function(h){d.urlGet=h;return f.openSheet()},openSheet:function(k,h){if(!f.isDirty?true:confirm(f.msg.openSheet)){f.controlFactory.header();var j=function(n,m){if(n==(m-1)){f.i=0;f.setActiveSheet();f.themeRoller.resize();for(var n=0;n<=f.sheetCount;n++){f.calc(n)}f.trigger("sheetOpened",[n])}};if(!k){jQuery("<div />").load(d.urlGet,function(){var l=jQuery(this).find("table");l.each(function(m){f.controlFactory.sheetUI(jQuery(this),m,function(){j(m,l.length)},true)});f.sheetSyncSize()})}else{var i=jQuery("<div />").html(k).children("table");i.show().each(function(l){f.controlFactory.sheetUI(jQuery(this),l,function(){j(l,i.length)},(h?true:false))})}f.setDirty(false);return true}else{return false}},newSheet:function(){var h=prompt(f.msg.newSheet);if(h){f.openSheet(jQuery.sheet.makeTable.fromSize(h))}},importRow:function(i){f.controlFactory.addRow(null,null,":last");var h="";f.obj.sheet().find("tr:last td").each(function(j){jQuery(this).removeAttr("formula");try{if((i[j]+"").charAt(0)=="="){jQuery(this).attr("formula",i[j])}else{jQuery(this).html(i[j])}}catch(k){h+=k+";\n"}});if(h){alert(h)}f.setTdIds();f.calc()},importColumn:function(h){f.controlFactory.addColumn();var i="";f.obj.sheet().find("tr").each(function(j){var l=jQuery(this).find("td:last");try{if((h[j]+"").charAt(0)=="="){l.attr("formula",h[j])}else{l.html(h[j])}}catch(k){i+=k+";\n"}});if(i){alert(i)}f.setTdIds();f.calc()},exportSheet:{xml:function(i){var k=f.sheetDecorateRemove(true);var h="";var j=["<![CDATA[","]]>"];if(i){j=["",""]}jQuery(k).each(function(){var q="";var o=jQuery(this);var n=0;var p="";o.find("colgroup").children().each(function(r){p+="<c"+r+">"+(jQuery(this).attr("width")+"").replace("px","")+"</c"+r+">"});var l=o.find("tr");var m=l.length;l.each(function(t){var s="";var w=jQuery(this);var v=w.attr("height");var r=(v?v:d.colMargin);var u=w.find("td");n=u.length;u.each(function(y){var D=jQuery(this);var A=D.attr("colspan");A=(A>1?A:"");var C=D.attr("formula");var B=(C?C:D.text());var x=D.attr("class");var z=D.attr("style");s+="<c"+y+(z?' style="'+z+'"':"")+(x?' class="'+x+'"':"")+(A?' colspan="'+A+'"':"")+">"+B+"</c"+y+">"});q+="<r"+t+' h="'+r+'">'+s+"</r"+t+">"});h+='<document title="'+o.attr("title")+'"><metadata><columns>'+n+"</columns><rows>"+m+"</rows><col_widths>"+p+"</col_widths></metadata><data>"+q+"</data></document>"});return"<documents>"+h+"</documents>"},json:function(){var i=f.sheetDecorateRemove(true);var h=[];jQuery(i).each(function(){var k={};k.metadata={};k.data={};var n=jQuery(this);var j=n.find("tr");var l=j.length;var m=0;var o="";j.each(function(p){var r=jQuery(this);var q=r.find("td");m=q.length;k.data["r"+p]={};k.data["r"+p]["h"]=r.attr("height");q.each(function(s){var v=jQuery(this);var t=v.attr("colspan");t=(t>1?t:null);var u=v.attr("formula");k.data["r"+p]["c"+s]={value:(u?u:v.text()),style:v.attr("style"),colspan:t,cl:v.attr("class")}})});k.metadata={columns:m,rows:l,title:n.attr("title"),col_widths:{}};n.find("colgroup").children().each(function(p){k.metadata["col_widths"]["c"+p]=(jQuery(this).attr("width")+"").replace("px","")});h.push(k)});return h},html:function(){return f.sheetDecorateRemove(true)}},sheetSyncSizeToDivs:function(){var h=0;f.obj.barTop().children().each(function(){h+=jQuery(this).width()-d.boxModelCorrection});f.obj.sheet().width(h).attr("width",h+"px").css("width",h+"px");return h},sheetSyncSizeToCols:function(h){var i=0;h=(h?h:f.obj.sheet());h.find("colgroup col").each(function(){i+=jQuery(this).width()});h.width(i)},sheetSyncSize:function(){var j=d.height;if(!j){j=400}else{if(j<200){j=200}}d.parent.height(j).width(d.width);var i=d.width-f.attrH.width(f.obj.barLeftParent())-(d.boxModelCorrection);j=j-f.attrH.height(f.obj.controls())-f.attrH.height(f.obj.barTopParent())-(d.boxModelCorrection*2);f.obj.pane().height(j).width(i).parent().width(i);f.obj.ui().width(i+f.attrH.width(f.obj.barLeftParent()));f.obj.barLeftParent().height(j);f.obj.barTopParent().width(i).parent().width(i)},cellChangeStyle:function(h,i){f.cellUndoable.add(f.obj.cellHighlighted());f.obj.cellHighlighted().css(h,i);f.cellUndoable.add(f.obj.cellHighlighted())},cellFind:function(h){if(!h){h=prompt("What are you looking for in this spreadsheet?")}if(h){var i=f.obj.sheet().find('td:contains("'+h+'")');if(i.length<1){i=f.obj.sheet().find('td:contains("'+h.toLowerCase()+'")')}if(i.length<1){i=f.obj.sheet().find('td:contains("'+h.toUpperCase()+'")')}i=i.eq(0);if(i.length>0){f.cellEdit(i)}else{alert(f.msg.cellFind)}}},cellSetActiveBar:function(m,i,k){var p=f.sheetSize(jQuery("#"+f.id.sheet+f.i));var l=(i<k?i:k);var n=(i<k?k:i);var h=function(u,r,t,q,s){switch(d.cellSelectModel){case"oo":f.cellEdit(jQuery(f.getTd(f.i,q,s)));break;default:f.cellEdit(jQuery(f.getTd(f.i,r,t)));break}h=function(v){return v};return u};var o;var j=[];switch(m){case"col":o=function(){for(var r=0;r<=p.height;r++){for(var q=l;q<=n;q++){j.push(f.getTd(f.i,r,q));f.themeRoller.cell.setHighlighted(h(j[j.length-1],0,i,0,k))}}};break;case"row":o=function(){for(var r=l;r<=n;r++){for(var q=0;q<=p.width;q++){j.push(f.getTd(f.i,r,q));f.themeRoller.cell.setHighlighted(h(j[j.length-1],i,0,k,0))}}};break;case"all":o=function(){h=function(s){f.cellEdit(jQuery(s));h=function(){}};for(var r=0;r<=p.height;r++){for(var q=0;q<=p.width;q++){j.push(f.getTd(f.i,r,q));h(j[j.length-1]);f.themeRoller.cell.setHighlighted(j[j.length-1])}}l={row:0,col:0};n={row:p.height,col:p.width}};break}o();f.highlightedLast.td=j;f.highlightedLast.rowStart=l.row;f.highlightedLast.colStart=l.col;f.highlightedLast.rowEnd=n.row;f.highlightedLast.colEnd=n.col},getTdRange:function(k,p,n,o){f.cellLast.isEdit=true;var i=function(r){if(r.first.col>r.last.col||r.first.row>r.last.row){return{first:jSE.parseCellName(r.last.col,r.last.row),last:jSE.parseCellName(r.first.col,r.first.row)}}else{return{first:jSE.parseCellName(r.first.col,r.first.row),last:jSE.parseCellName(r.last.col,r.last.row)}}};var m=function(u){var r=i(u);var t=p+"";t=(t.match(/=/)?t:"="+t);if(n||t.charAt(t.length-1)!="("){t=t+(n?n:"")+"("}var v;var s="";if(r.first!=r.last){v=r.first+":"+r.last}else{v=r.first}if(t.charAt(t.length-1)=="("){s=")"}return t+v+s};var h="";if(k){var j={first:f.getTdLocation([k.target])};var l=f.obj.sheet().mousemove(function(r){j.last=f.getTdLocation([r.target]);h=m(j);if(!o){f.obj.formula().val(h);f.obj.inPlaceEdit().val(h)}});jQuery(document).one("mouseup",function(){l.unbind("mousemove");return h})}else{var q=f.obj.cellHighlighted().not(f.obj.cellActive());if(q.length){var j={first:f.getTdLocation(q.first()),last:f.getTdLocation(q.last())};h=m(j);if(!o){f.obj.formula().val(h);f.obj.inPlaceEdit().val(h)}return h}else{return""}}},getTdId:function(h,j,i){return c+"_table"+h+"_cell_c"+i+"_r"+j},getTd:function(h,j,i){return document.getElementById(f.getTdId(h,j,i))},getTdLocation:function(h){if(!h||!h[0]){return{col:0,row:0}}return{col:parseInt(h[0].cellIndex),row:parseInt(h[0].parentNode.rowIndex)}},getTdFromXY:function(j,i,k){var m=f.obj.pane();var h=(k?{left:0,top:0}:m.offset());i+=h.top+2;j+=h.left+2;if((i>=h.top&&i<=h.top+m.height())&&(j>=h.left&&j<=h.left+m.width())){var l=jQuery(document.elementFromPoint(j-g.scrollLeft(),i-g.scrollTop()));if(f.isTd(l)){return l}return false}},getBarLeftIndex:function(j){var h=jQuery.trim(jQuery(j).text());if(isNaN(h)){return -1}else{return h-1}},getBarTopIndex:function(k){var h=jQuery.trim(jQuery(k).text());if(!h){return -1}var j=jSE.columnLabelIndex(h);j=parseInt(j);if(isNaN(j)){return -1}else{return j}},EMPTY_VALUE:{},time:{now:new Date(),last:new Date(),diff:function(){return Math.abs(Math.ceil(this.last.getTime()-this.now.getTime())/1000).toFixed(5)},set:function(){this.last=this.now;this.now=new Date()},get:function(){return this.now.getHours()+":"+this.now.getMinutes()+":"+this.now.getSeconds()}},log:function(h){f.time.set();console.log(f.time.get()+", "+f.time.diff()+"; "+h)},replaceWithSafeImg:function(h){(h?h:f.obj.sheet().find("img")).each(function(){var i=jQuery(this).attr("src");jQuery(this).replaceWith(f.controlFactory.safeImg(i,f.getTdLocation(jQuery(this).parent()).row))})},isDirty:false,setDirty:function(h){f.isDirty=h},appendToFormula:function(h,j){var k=f.obj.formula();var i=k.val();if(i.charAt(0)!="="){i="="+i}k.val(i+h)},cellUndoable:{undoOrRedo:function(h){if(d.autoFiller){f.obj.autoFiller().hide()}if(h&&this.i>0){this.i--;this.i--}else{if(!h&&this.i<this.stack.length){this.i++;this.i++}}this.get().clone().each(function(){var i=jQuery(this);var j=i.attr("undoable");if(j){jQuery("#"+j).replaceWith(i.removeAttr("undoable").attr("id",j))}else{f.log("Not available.")}});f.themeRoller.cell.clearActive();f.themeRoller.bar.clearActive();f.themeRoller.cell.clearHighlighted();f.calc()},get:function(){return jQuery(this.stack[this.i])},add:function(j){var k=j.clone().each(function(){var i=jQuery(this);var l=i.attr("id");if(!l){return}i.removeAttr("id").attr("undoable",l).removeClass(f.cl.cellHighlighted+" "+f.cl.uiCellHighlighted)});this.stack[this.i++]=k;if(this.stack.length>this.i){for(var h=this.stack.length;h>this.i;h--){this.stack.pop()}}if(this.stack.length>20){this.stack.shift()}},i:0,stack:[]},sheetSize:function(i){var h=f.getTdLocation((i?i:f.obj.sheet()).find("td:last"));return{width:h.col,height:h.row}},toggleState:function(h){if(d.allowToggleState){if(d.editable){f.evt.cellEditAbandon();f.saveSheet()}f.setDirty(false);d.editable=!d.editable;f.obj.tabContainer().remove();var i=(h?h:f.obj.sheetAll().clone());b.children().remove();f.openSheet(i,true)}},setCellRef:function(h){var i=f.obj.cellActive();loc=f.getTdLocation(i);cellRef=(h?h:prompt("Enter the name you would like to reference the cell by."));if(cellRef){f.spreadsheets[cellRef]=f.spreadsheets[f.i][loc.row][loc.col]}f.calc()},buildSheet:function(){if(f.s.buildSheet){if(typeof(f.s.buildSheet)=="object"){return f.s.buildSheet}else{if(f.s.buildSheet==true||f.s.buildSheet=="true"){return jQuery(f.s.origHtml)}else{if(f.s.buildSheet.match(/x/i)){return jQuery.sheet.makeTable.fromSize(f.s.buildSheet)}}}}}};var g=jQuery(window);var a=function(){};f.lexer=function(){};f.lexer.prototype=parser.lexer;f.parser=function(){this.lexer=new f.lexer();this.yy={}};f.parser.prototype=parser;f.Parser=new f.parser;d.origParent=b;d.origHtml=b.html();d.parent.html("").addClass(f.cl.parent);b.unbind("switchSpreadsheet").bind("switchSpreadsheet",function(k,j,h){f.switchSpreadsheet(h)}).unbind("renameSpreadsheet").bind("renameSpreadsheet",function(k,j,h){f.renameSpreadsheet(h)});d.width=(d.width?d.width:d.parent.width());d.height=(d.height?d.height:d.parent.height());if(!d.log){f.log=a}if(!jQuery.ui||!d.resizable){f.resizable=f.draggable=a}if(!jQuery.support.boxModel){d.boxModelCorrection=0}if(!jQuery.scrollTo){f.followMe=a}if(!d.barMenus){f.controlFactory.barTopMenu=f.controlFactory.barLeftMenu=a}if(!d.freezableCells){f.controlFactory.barTopHandle=f.controlFactory.barLeftHandle=a}if(d.calcOff){f.calc=a}if(!window.Raphael){jSE.chart=a}g.resize(function(){if(f){d.width=d.parent.width();d.height=d.parent.height();f.sheetSyncSize()}});if(jQuery.sheet.fn){jQuery.sheet.fn=jQuery.extend(jQuery.sheet.fn,d.calculations);if(jQuery.sheet.advancedfn){jQuery.sheet.fn=jQuery.extend(jQuery.sheet.fn,jQuery.sheet.advancedfn)}if(jQuery.sheet.financefn){jQuery.sheet.fn=jQuery.extend(jQuery.sheet.fn,jQuery.sheet.financefn)}}if(!d.alertFormulaErrors){f.alertFormulaError=a}f.s=d;f.openSheet(f.buildSheet(),d.forceColWidthsOnStartup);return f},makeTable:{xml:function(b){var a=jQuery("<div />");jQuery(b).find("document").each(function(u){var z=jQuery("<table />");var y=0;var m=jQuery("<colgroup />").appendTo(z);var d=jQuery("<tbody />");var s=jQuery(this).find("metadata");var A=s.find("columns").text();var n=s.find("rows").text();var C=jQuery(this).attr("title");var B=jQuery(this).find("data");var f=s.find("col_widths").children();for(var u=0;u<parseInt(jQuery.trim(A));u++){var o=parseInt(f.eq(u).text().replace("px",""));o=(o?o:120);y+=o;m.append('<col width="'+o+'px" style="width: '+o+'px;" />')}z.width(y).attr("title",C);for(var u=0;u<n;u++){var v=B.find("r"+u);var q=(B.attr("h")+"").replace("px","");q=parseInt(q);var t=jQuery('<tr height="'+(q?q:18)+'px" />');for(var r=0;r<A;r++){var g="<td />";var k=v.find("c"+r);if(k){var p=k.text()+"";var l=k.attr("class");var x=k.attr("style");var h=k.attr("colspan");var c="";if(p.charAt(0)=="="){c=' formula="'+p+'"'}g="<td"+c+(x?' style="'+x+'"':"")+(l?' class="'+l+'"':"")+(h?' colspan="'+h+'"':"")+(q?' height="'+q+'px"':"")+">"+p+"</td>"}t.append(g)}d.append(t)}z.append(d).appendTo(a)});return a.children()},json:function(data,makeEval){sheet=(makeEval==true?eval("("+data+")"):data);var tables=jQuery("<div />");sheet=(jQuery.isArray(sheet)?sheet:[sheet]);for(var i=0;i<sheet.length;i++){var colCount=parseInt(sheet[i].metadata.columns);var rowCount=parseInt(sheet[i].metadata.rows);title=sheet[i].metadata.title;title=(title?title:"Spreadsheet "+i);var table=jQuery("<table />");var tableWidth=0;var colgroup=jQuery("<colgroup />").appendTo(table);var tbody=jQuery("<tbody />");if(sheet[i]["metadata"]["col_widths"]){for(var x=0;x<colCount;x++){var w=120;if(sheet[i]["metadata"]["col_widths"]["c"+x]){var newW=parseInt(sheet[i]["metadata"]["col_widths"]["c"+x].replace("px",""));w=(newW?newW:120);tableWidth+=w}colgroup.append('<col width="'+w+'px" style="width: '+w+'px;" />')}}table.attr("title",title).width(tableWidth);for(var x=0;x<rowCount;x++){var tr=jQuery("<tr />").appendTo(table);tr.attr("height",(sheet[i]["data"]["r"+x].h?sheet[i]["data"]["r"+x].h:18));for(var y=0;y<colCount;y++){var cell=sheet[i]["data"]["r"+x]["c"+y];var cur_val;var colSpan;var style;var cl;if(cell){cur_val=cell.value+"";colSpan=cell.colSpan+"";style=cell.style+"";cl=cell.cl+""}var cur_td=jQuery("<td"+(style?' style="'+style+'"':"")+(cl?' class="'+cl+'"':"")+(colSpan?' colspan="'+colSpan+'"':"")+" />");try{if(typeof(cur_val)=="number"){cur_td.html(cur_val)}else{if(cur_val.charAt(0)=="="){cur_td.attr("formula",cur_val)}else{cur_td.html(cur_val)}}}catch(e){}tr.append(cur_td)}}tables.append(table)}return tables.children()},fromSize:function(n,f,l){if(!n){n="5x10"}n=n.toLowerCase().split("x");var b=parseInt(n[0]);var g=parseInt(n[1]);var m=jQuery("<table />");var a="<td></td>";var d="";for(var c=b;c>=1;c--){d+=a}var k="<tr"+(f?' height="'+f+'px" style="height: '+f+'px;"':"")+">"+d+"</tr>";var j="";for(var c=g;c>=1;c--){j+=k}m.html("<tbody>"+j+"</tbody>");if(l){m.width(b*l)}return m}},killAll:function(){if(jQuery.sheet){if(jQuery.sheet.instance){for(var a=0;a<jQuery.sheet.instance.length;a++){if(jQuery.sheet.instance[a]){if(jQuery.sheet.instance[a].kill){jQuery.sheet.instance[a].kill()}}}}}},paneScrollLocker:function(b,a){var c=a.obj.pane();jQuery(jQuery.sheet.instance).each(function(d){if(a.I==d){return}this.obj.pane().scrollLeft(c.scrollLeft()).scrollTop(c.scrollTop())})},switchSheetLocker:function(b,a){jQuery(jQuery.sheet.instance).each(function(c){if(a.I==c){return}this.setActiveSheet(a.i)})},I:function(){var a=0;if(this.instance){a=(this.instance.length===0?0:this.instance.length-1)}else{this.instance=[]}return a}};var jSE=jQuery.sheet.engine={calc:function(c,f,g,a){for(var d=0;d<f.length;d++){for(var b=0;b<f[d].length;b++){f[d][b].calcCount=0}}for(var d=0;d<f.length;d++){for(var b=0;b<f[d].length;b++){g(c,d,b)}}},parseLocation:function(b){for(var a=0;a<b.length;a++){if(b.charCodeAt(a)<=57){break}}return{row:parseInt(b.substring(a))-1,col:this.columnLabelIndex(b.substring(0,a))}},parseCellName:function(a,b){return jSE.columnLabelString(a)+(b+1)},columnLabelIndex:function(c){var a=0;for(var b=0;b<c.length;b++){var d=c.toUpperCase().charCodeAt(b)-65;a=(a*26)+d}return(a>=0?a:0)},columnLabelString:function(f){var d=(f).toString(26).toUpperCase();var h=[];for(var g=0;g<d.length;g++){var a=d.charCodeAt(g);if(g<=0&&d.length>1){a=a-1}if(a<=57){h.push(String.fromCharCode(a-48+65))}else{h.push(String.fromCharCode(a+10))}}return h.join("")},cFN:{sum:function(a,b){return a+b},max:function(a,b){return a>b?a:b},min:function(a,b){return a<b?a:b},count:function(a,b){return(b!=null)?a+1:a},divide:function(a,b){return a/b},clean:function(a){if(typeof(a)=="string"){a=a.replace(jSE.regEx.amp,"&").replace(jSE.regEx.nbsp," ").replace(/\n/g,"").replace(/\r/g,"")}return a},sanitize:function(a){if(a){if(isNaN(a)){return a}else{return a*1}}return""}},regEx:{n:/[\$,\s]/g,cell:/\$?([a-zA-Z]+)\$?([0-9]+)/gi,range:/\$?([a-zA-Z]+)\$?([0-9]+):\$?([a-zA-Z]+)\$?([0-9]+)/gi,remoteCell:/\$?(SHEET+)\$?([0-9]+)[:!]\$?([a-zA-Z]+)\$?([0-9]+)/gi,remoteCellRange:/\$?(SHEET+)\$?([0-9]+)[:!]\$?([a-zA-Z]+)\$?([0-9]+):\$?([a-zA-Z]+)\$?([0-9]+)/gi,sheet:/SHEET/i,amp:/&/g,gt:/</g,lt:/>/g,nbsp:/&nbsp;/g},str:{amp:"&amp;",lt:"&lt;",gt:"&gt;",nbsp:"&nbps;"},chart:function(d){var c=this.jS;var a=this;function b(f,g){if(!f){if(g){f=0}else{f=""}}else{if(g){f=arrHelpers.toNumbers(f)}else{f=arrHelpers.flatten(f)}}return f}d=jQuery.extend({x:{legend:"",data:[0]},y:{legend:"",data:[0]},title:"",data:[0],legend:"",chart:jQuery('<div class="'+c.cl.chart+'" />').mousedown(function(){jQuery(this).parent().mousedown()}).mousemove(function(){jQuery(this).parent().mousemove();return false})},d);d.data=b(d.data,true);d.x.data=b(d.x.data,true);d.y.data=b(d.y.data,true);d.legend=b(d.legend);d.x.legend=b(d.x.legend);d.y.legend=b(d.y.legend);d.legend=(d.legend?d.legend:d.data);this.s.origParent.one("calculation",function(){var h=d.chart.width();var f=d.chart.height();var i=Raphael(d.chart[0]);if(i.g){if(d.title){i.g.text(h/2,10,d.title).attr({"font-size":20})}switch(d.type){case"bar":i.g.barchart(h/8,f/8,h*0.8,f*0.8,d.data,d.legend).hover(function(){this.flag=i.g.popup(this.bar.x,this.bar.y,this.bar.value||"0").insertBefore(this)},function(){this.flag.animate({opacity:0},300,function(){this.remove()})});break;case"hbar":i.g.hbarchart(h/8,f/8,h*0.8,f*0.8,d.data,d.legend).hover(function(){this.flag=i.g.popup(this.bar.x,this.bar.y,this.bar.value||"0").insertBefore(this)},function(){this.flag.animate({opacity:0},300,function(){this.remove()})});break;case"line":i.g.linechart(h/8,f/8,h*0.8,f*0.8,d.x.data,d.y.data,{nostroke:false,axis:"0 0 1 1",symbol:"o",smooth:true}).hoverColumn(function(){this.tags=i.set();try{for(var j=0;j<this.y.length;j++){this.tags.push(i.g.tag(this.x,this.y[j],this.values[j],0,10).insertBefore(this).attr([{fill:"#fff"},{fill:this.symbols[j].attr("fill")}]))}}catch(k){}},function(){this.tags&&this.tags.remove()});break;case"pie":var g=i.g.piechart(h/2,f/2,(h<f?h:f)/2,d.data,{legend:d.legend}).hover(function(){this.sector.stop();this.sector.scale(1.1,1.1,this.cx,this.cy);if(this.label){this.label[0].stop();this.label[0].scale(1.5);this.label[1].attr({"font-weight":800})}},function(){this.sector.animate({scale:[1,1,this.cx,this.cy]},500,"bounce");if(this.label){this.label[0].animate({scale:1},500,"bounce");this.label[1].attr({"font-weight":400})}});break;case"dot":i.g.dotchart(h/8,f/8,h*0.8,f*0.8,d.x.data,d.y.data,d.data,{symbol:"o",max:10,heat:true,axis:"0 0 1 1",axisxstep:d.x.data.length-1,axisystep:d.y.data.length-1,axisxlabels:(d.x.legend?d.x.legend:d.x.data),axisylabels:(d.y.legend?d.y.legend:d.y.data),axisxtype:" ",axisytype:" "}).hover(function(){this.tag=this.tag||i.g.tag(this.x,this.y,this.value,0,this.r+2).insertBefore(this);this.tag.show()},function(){this.tag&&this.tag.hide()});break}c.attrH.setHeight(a.row,"cell",false)}});return d.chart}};var jFN=jQuery.sheet.fn={VERSION:function(){return this.jS.version},IMG:function(a){return jQuery("<img />").attr("src",a)},AVERAGE:function(b){var a=arrHelpers.foldPrepare(b,arguments);return jFN.SUM(a)/jFN.COUNT(a)},AVG:function(a){return jFN.AVERAGE(a)},COUNT:function(a){return arrHelpers.fold(arrHelpers.foldPrepare(a,arguments),jSE.cFN.count,0)},COUNTA:function(){var c=0;var a=arrHelpers.flatten(arguments);for(var b=0;b<a.length;b++){if(a[b]){c++}}return c},SUM:function(a){return arrHelpers.fold(arrHelpers.foldPrepare(a,arguments),jSE.cFN.sum,0,true,jFN.N)},MAX:function(a){return arrHelpers.fold(arrHelpers.foldPrepare(a,arguments),jSE.cFN.max,Number.MIN_VALUE,true,jFN.N)},MIN:function(a){return arrHelpers.fold(arrHelpers.foldPrepare(a,arguments),jSE.cFN.min,Number.MAX_VALUE,true,jFN.N)},MEAN:function(a){return this.SUM(a)/a.length},ABS:function(a){return Math.abs(jFN.N(a))},CEILING:function(a){return Math.ceil(jFN.N(a))},FLOOR:function(a){return Math.floor(jFN.N(a))},INT:function(a){return Math.floor(jFN.N(a))},ROUND:function(b,a){return jFN.FIXED(b,(a?a:0),false)},RAND:function(){return Math.random()},RND:function(){return Math.random()},TRUE:function(){return"TRUE"},FALSE:function(){return"FALSE"},NOW:function(){return new Date()},TODAY:function(){return Date(Math.floor(new Date()))},DAYSFROM:function(b,c,a){return Math.floor((new Date()-new Date(b,(c-1),a))/86400000)},DAYS:function(f,c){var b=new Date(f);var a=new Date(c);var d=1000*60*60*24;return Math.round(Math.abs(b.getTime()-a.getTime())/d)},DATEVALUE:function(a){var b=new Date(a);return b.getDate()+"/"+(b.getMonth()+1)+"/"+b.getFullYear()},IF:function(c,b,a){return(c?b:a)},FIXED:function(j,c,k){if(c==null){c=2}var h=Math.pow(10,c);var b=String(Math.round(jFN.N(j)*h)/h);var a=b.indexOf(".");if(a<0){a=b.length;b+="."}for(var d=b.length-a-1;d<c;d++){b+="0"}if(k==true){return b}var g=b.replace("-","").split(".");var l=[];var f=true;while(g[0].length>0){if(!f){l.unshift(",")}l.unshift(g[0].slice(-3));g[0]=g[0].slice(0,-3);f=false}if(c>0){l.push(".");var f=true;while(g[1].length>0){if(!f){l.push(",")}l.push(g[1].slice(0,3));g[1]=g[1].slice(3);f=false}}if(j<0){return"-"+l.join("")}return l.join("")},TRIM:function(a){if(typeof(a)=="string"){a=jQuery.trim(a)}return a},HYPERLINK:function(b,a){a=(a?a:"LINK");return jQuery('<a href="'+b+'" target="_new">'+a+"</a>")},DOLLAR:function(b,a,d){if(a==null){a=2}if(d==null){d="$"}var c=jFN.FIXED(b,a,false);if(b>=0){this.cell.html=d+c}else{this.cell.html="-"+d+c.slice(1)}return b},VALUE:function(a){return parseFloat(a)},N:function(a){if(a==null){return 0}if(a instanceof Date){return a.getTime()}if(typeof(a)=="object"){a=a.toString()}if(typeof(a)=="string"){a=parseFloat(a.replace(jSE.regEx.n,""))}if(isNaN(a)){return 0}if(typeof(a)=="number"){return a}if(a==true){return 1}return 0},PI:function(){return Math.PI},POWER:function(a,b){return Math.pow(a,b)},SQRT:function(a){return Math.sqrt(a)},DROPDOWN:function(b,f){b=arrHelpers.foldPrepare(b,arguments,true);var a=this.cell;var d=this.jS;if(this.s.editable){var h="dropdown"+this.sheet+"_"+this.row+"_"+this.col+"_"+this.jS.I;var g=jQuery('<select style="width: 100%;" name="'+h+'" id="'+h+'" />').mousedown(function(){d.cellEdit(jQuery(this).parent(),null,true)});if(!f){g.append('<option value="">Select a value</option>')}for(var c=0;c<(b.length<=50?b.length:50);c++){if(b[c]){g.append('<option value="'+b[c]+'">'+b[c]+"</option>")}}if(jQuery(d.getTd(this.sheet,this.row,this.col)).find("#"+h).length==0){a.selectedValue=d.spreadsheets[this.sheet][this.row][this.col].value}d.s.origParent.one("calculation",function(){jQuery("#"+h).change(function(){a.selectedValue=jQuery(this).val();d.calc()});d.attrH.setHeight(d.getTdLocation(g.parent()).row,"cell",false)});g.val(a.selectedValue);this.cell.html=g}return a.selectedValue},RADIO:function(c){c=arrHelpers.foldPrepare(c,arguments,true);var a=this.cell;var f=this.jS;if(this.s.editable){var h="radio"+this.sheet+"_"+this.row+"_"+this.col+"_"+this.jS.I;var g=jQuery("<span />").mousedown(function(){f.cellEdit(jQuery(this).parent())});for(var d=0;d<(c.length<=25?c.length:25);d++){if(c[d]){var b=jQuery('<input type="radio" name="'+h+'" class="'+h+'" />').val(c[d]);if(c[d]==a.selectedValue){b.attr("checked","true")}g.append(b).append("<span>"+c[d]+"</span>").append("<br />");f.s.origParent.one("calculation",function(){jQuery("."+h).change(function(){a.selectedValue=jQuery(this).val();f.calc()});f.attrH.setHeight(f.getTdLocation(g.parent()).row,"cell",false)})}}if(jQuery(f.getTd(this.sheet,this.row,this.col)).find("."+h).length==0){a.selectedValue=f.spreadsheets[this.sheet][this.row][this.col].value}this.cell.html=g}return a.selectedValue},CHECKBOX:function(b){b=arrHelpers.foldPrepare(b,arguments)[0];var a=this.cell;var f=this.jS;if(this.s.editable){var i="checkbox"+this.sheet+"_"+this.row+"_"+this.col+"_"+this.jS.I;var d=jQuery('<input type="checkbox" name="'+i+'" class="'+i+'" />').val(b);var g=jQuery("<span />").append(d).append("<span>"+b+"</span><br />").mousedown(function(){f.cellEdit(jQuery(this).parent())});if(b==a.selectedValue){d.attr("checked",true)}var h=jQuery(f.getTd(this.sheet,this.row,this.col));if(!h.children().length){if(h.text()==a.selectedValue){d.attr("checked",true)}}f.s.origParent.one("calculation",function(){jQuery("."+i).change(function(){a.selectedValue=(jQuery(this).is(":checked")?jQuery(this).val():"");f.calc()})});if(jQuery(f.getTd(this.sheet,this.row,this.col)).find("."+i).length==0){var c=f.spreadsheets[this.sheet][this.row][this.col].value;a.selectedValue=(c=="true"||c==true?b:"")}this.cell.html=g}return a.selectedValue},BARCHART:function(a,b,c){return jSE.chart.apply(this,[{type:"bar",data:a,legend:b,title:c}])},HBARCHART:function(a,b,c){return jSE.chart.apply(this,[{type:"hbar",data:a,legend:b,title:c}])},LINECHART:function(b,a){return jSE.chart.apply(this,[{type:"line",x:{data:b},y:{data:a},title:""}])},PIECHART:function(a,b,c){return jSE.chart.apply(this,[{type:"pie",data:a,legend:b,title:c}])},DOTCHART:function(g,d,a,c,b,f){return jSE.chart.apply(this,[{type:"dot",data:(a?a:g),x:{data:g,legend:c},y:{data:(d?d:g),legend:(b?b:c)},title:f}])},CELLREF:function(a){return(this.jS.spreadsheets[a]?this.jS.spreadsheets[a]:"Cell Reference Not Found")},CALCTIME:function(){var a=this;this.s.origParent.one("calculation",function(){jQuery(a.jS.getTd(a.sheet,a.row,a.col)).text(a.jS.time.diff())});return""}};var key={BACKSPACE:8,CAPS_LOCK:20,COMMA:188,CONTROL:17,ALT:18,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,F:70,V:86,Y:89,Z:90};var arrHelpers={foldPrepare:function(b,d,c){var a;if(b!=null&&b instanceof Object&&b.length!=null){a=b}else{a=d}if(c){a=this.unique(a)}return a},fold:function(b,g,a,d,f){for(var c=0;c<b.length;c++){a=g(a,(d==true?f(b[c]):b[c]))}return a},toNumbers:function(a){a=this.flatten(a);for(var b=0;b<a.length;b++){if(a[b]){a[b]=jQuery.trim(a[b]);if(isNaN(a[b])){a[b]=0}else{a[b]=a[b]*1}}else{a[b]=0}}return a},unique:function(b){var d=[];var c=b.length;for(var g=0;g<c;g++){for(var f=g+1;f<c;f++){if(b[g]===b[f]){f=++g}}d.push(b[g])}return d},flatten:function(a){var f=[];for(var c=0,b=a.length;c<b;c++){var d=Object.prototype.toString.call(a[c]).split(" ").pop().split("]").shift().toLowerCase();if(d){f=f.concat(/^(array|collection|arguments|object)$/.test(d)?this.flatten(a[c]):a[c])}}return f},insertAt:function(a,c,b){jQuery(c).each(function(){if(b>-1&&b<=a.length){a.splice(b,0,this)}});return a}};
